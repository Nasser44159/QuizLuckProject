
    <!DOCTYPE html>
    <html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Quiz Luck</title>
        <link rel="stylesheet" href="../../stylequiz.css">
    </head>
    <body>
        <div class="container">
            <div class="quiz-title">
                <h1>QCM Anatomie 1</h1>
            </div>
            <form id="quiz-form">
    <input type="hidden" id='exam_name' name="exam_name" value="RdBP">
    {% csrf_token %}>
    
        <div id="question-1" class="question-container">
            <div class="question">
                <p>1.) La radiographie thoracique n'est pas toujours indiquée en pathologie digestive. Elle peut être utile dans les situations suivantes :</p>
                <ul>
        
                    <li><input type="checkbox" id="q1a" name="q1" value="A"> A- A. Ingestion de corps étranger</li>
            
                    <li><input type="checkbox" id="q1b" name="q1" value="B"> B- B. Mégaœsophage en montrant une opacité médiastinale avec niveau hydroaérique</li>
            
                    <li><input type="checkbox" id="q1c" name="q1" value="C"> C- C. Hernie hiatale en montrant une image hydroaérique rétrocardiaque</li>
            
                    <li><input type="checkbox" id="q1d" name="q1" value="D"> D- D. Dans la sténose de l'œsophage en montrant la diminution localisée de son calibre</li>
            
                    <li><input type="checkbox" id="q1e" name="q1" value="E"> E- E. Dans le bilan d'extension en oncologie de l'appareil digestif</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q1')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q1')">Réessayer</button>
                <button class="favorite-button" data-question="1">&#10084;</button>
            </div>
        </div>
        
        <div id="question-2" class="question-container">
            <div class="question">
                <p>2.) En imagerie digestive, les trois techniques récentes en TDM sont :</p>
                <ul>
        
                    <li><input type="checkbox" id="q2a" name="q2" value="A"> A- A. L'entéro IRM</li>
            
                    <li><input type="checkbox" id="q2b" name="q2" value="B"> B- B. La coloscopie virtuelle</li>
            
                    <li><input type="checkbox" id="q2c" name="q2" value="C"> C- C. La bili IRM</li>
            
                    <li><input type="checkbox" id="q2d" name="q2" value="D"> D- D. Le coloscanner à l'eau</li>
            
                    <li><input type="checkbox" id="q2e" name="q2" value="E"> E- E. L'entéro-scanner</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q2')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q2')">Réessayer</button>
                <button class="favorite-button" data-question="2">&#10084;</button>
            </div>
        </div>
        
        <div id="question-3" class="question-container">
            <div class="question">
                <p>3.) Dans un ASP debout, les éléments en faveur du caractère fonctionnel d'une occlusion sont :</p>
                <ul>
        
                    <li><input type="checkbox" id="q3a" name="q3" value="A"> A- A. Les niveaux sont de type grêliques</li>
            
                    <li><input type="checkbox" id="q3b" name="q3" value="B"> B- B. La présence d'air dans le côlon gauche et dans le rectum</li>
            
                    <li><input type="checkbox" id="q3c" name="q3" value="C"> C- C. La migration des clartés gazeuses vers le bas au cours des clichés de contrôle</li>
            
                    <li><input type="checkbox" id="q3d" name="q3" value="D"> D- D. Les niveaux sont plus hauts que larges</li>
            
                    <li><input type="checkbox" id="q3e" name="q3" value="E"> E- E. Les signes de souffrance digestive</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q3')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q3')">Réessayer</button>
                <button class="favorite-button" data-question="3">&#10084;</button>
            </div>
        </div>
        
        <div id="question-4" class="question-container">
            <div class="question">
                <p>4.) Dans le cadre de la surveillance de la maladie de Crohn et en cas de nouvelle poussée sans signe de gravité, l'examen privilégié est :</p>
                <ul>
        
                    <li><input type="checkbox" id="q4a" name="q4" value="A"> A- A. L'ASP</li>
            
                    <li><input type="checkbox" id="q4b" name="q4" value="B"> B- B. Le scanner</li>
            
                    <li><input type="checkbox" id="q4c" name="q4" value="C"> C- C. La bili-IRM</li>
            
                    <li><input type="checkbox" id="q4d" name="q4" value="D"> D- D. Le transit du grêle</li>
            
                    <li><input type="checkbox" id="q4e" name="q4" value="E"> E- E. L'entéro IRM</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q4')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q4')">Réessayer</button>
                <button class="favorite-button" data-question="4">&#10084;</button>
            </div>
        </div>
        
        <div id="question-5" class="question-container">
            <div class="question">
                <p>5.) Une jeune patiente victime d'une chute d'un lieu élevé ; le scanner cérébral révèle des hypodensités du lobe frontal gauche. Quel est votre diagnostic ?</p>
                <ul>
        
                    <li><input type="checkbox" id="q5a" name="q5" value="A"> A- A. Hématome sous durale aigu</li>
            
                    <li><input type="checkbox" id="q5b" name="q5" value="B"> B- B. Hématome extradural</li>
            
                    <li><input type="checkbox" id="q5c" name="q5" value="C"> C- C. Hémorragie méningée avec contusion hémorragique</li>
            
                    <li><input type="checkbox" id="q5d" name="q5" value="D"> D- D. Cisaillement axonale</li>
            
                    <li><input type="checkbox" id="q5e" name="q5" value="E"> E- E. Contusion œdémateuse cérébrale</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q5')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q5')">Réessayer</button>
                <button class="favorite-button" data-question="5">&#10084;</button>
            </div>
        </div>
        
        <div id="question-6" class="question-container">
            <div class="question">
                <p>6.) Un malade de 60 ans présente une hémiplégie gauche d'installation brutale. Le scanner cérébral révèle une hyperdensité du noyau lenticulaire et du genou de la capsule interne gauche. Votre diagnostic est :</p>
                <ul>
        
                    <li><input type="checkbox" id="q6a" name="q6" value="A"> A- A. AVC hémorragique</li>
            
                    <li><input type="checkbox" id="q6b" name="q6" value="B"> B- B. AVC ischémique du territoire de l'artère cérébrale antérieure gauche</li>
            
                    <li><input type="checkbox" id="q6c" name="q6" value="C"> C- C. AVC ischémique du territoire profond de l'artère sylvienne gauche</li>
            
                    <li><input type="checkbox" id="q6d" name="q6" value="D"> D- D. AVC ischémique du territoire superficiel de l'artère sylvienne gauche</li>
            
                    <li><input type="checkbox" id="q6e" name="q6" value="E"> E- E. Une tumeur cérébrale</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q6')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q6')">Réessayer</button>
                <button class="favorite-button" data-question="6">&#10084;</button>
            </div>
        </div>
        
        <div id="question-7" class="question-container">
            <div class="question">
                <p>7.) Un jeune patient de 30 ans présente des céphalées intenses avec vomissements et photophobie, le scanner cérébral révèle une hyperdensité spontanée au niveau des citernes de la base</p>
                <ul>
        
                    <li><input type="checkbox" id="q7a" name="q7" value="A"> A- A. Il s'agit d'une hémorragie méningée</li>
            
                    <li><input type="checkbox" id="q7b" name="q7" value="B"> B- B. Il s'agit d'un AVC ischémique du territoire de l'artère cérébrale postérieure</li>
            
                    <li><input type="checkbox" id="q7c" name="q7" value="C"> C- C. Il s'agit d'une méningite</li>
            
                    <li><input type="checkbox" id="q7d" name="q7" value="D"> D- D. Il s'agit d'une hémorragie ventriculaire</li>
            
                    <li><input type="checkbox" id="q7e" name="q7" value="E"> E- E. Aucune de ces propositions n'est juste</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q7')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q7')">Réessayer</button>
                <button class="favorite-button" data-question="7">&#10084;</button>
            </div>
        </div>
        
        <div id="question-8" class="question-container">
            <div class="question">
                <p>8.) Une patiente âgée de 20 ans présente brutalement des céphalées en casque, l'examen Clinique révèle une raideur méningée avec état d'obnubilation, le scanner retrouve une hyperdensité des deux vallées sylviennes et de la faux du cerveau, il s'agit :</p>
                <ul>
        
                    <li><input type="checkbox" id="q8a" name="q8" value="A"> A- A. D'une hémorragie méningée massive</li>
            
                    <li><input type="checkbox" id="q8b" name="q8" value="B"> B- B. D'un aspect en faveur d'une méningite</li>
            
                    <li><input type="checkbox" id="q8c" name="q8" value="C"> C- C. D'un aspect en faveur d'une tuberculose cérébrale</li>
            
                    <li><input type="checkbox" id="q8d" name="q8" value="D"> D- D. De foyers de contusions hémorragiques multiples</li>
            
                    <li><input type="checkbox" id="q8e" name="q8" value="E"> E- E. D'un œdème cérébral vasogénique</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q8')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q8')">Réessayer</button>
                <button class="favorite-button" data-question="8">&#10084;</button>
            </div>
        </div>
        
            <div class="button-container">
                <button type="button" class="submit-quiz-button" onclick="submitQuiz()">Soumettre tout le Quiz</button>
                <button id="voir-favoris-btn" class="favorite-button" onclick="voirFavoris2016R()">Voir Favoris</button>
            </div>

            <div class="blur-background" id="blur-background"></div>

            <div class="result-popup" id="result-popup">
                <h3>Résultat du Quiz</h3>
                <div id="result"></div>
                <button id="close-result" class="close-button" onclick="closeResult(event)">Fermer</button>
                <button id="voir-detail-btn" class="detail-button" style="display: none;" onclick="afficherDetails(event)">Voir Détail</button>
                <button type="button" class="reset-quiz-button" onclick="resetAll()">Réessayer tout le Quiz</button>
            </div>

            <div id="details-section" class="details-section" style="display: none;">
                <h3>Tableau des questions</h3>
                <div class="question-links" id="question-links"></div>
            </div>

            <div id="timer-container">
                <span id="timer">60:00</span>
            </div>
    
            <script>
                // Réponses correctes pour les questions
                const correctAnswers = {
};


                // Contenu du fichier JavaScript
                // Variable globale pour stocker l'intervalle du timer
let timerInterval;
const userAnswers = {}; // Object pour stocker les réponses de l'utilisateur

// Fonction pour démarrer le timer
function startTimer(duration, display) {
    let timer = duration, minutes, seconds;

    timerInterval = setInterval(() => {
        minutes = parseInt(timer / 60, 10);
        seconds = parseInt(timer % 60, 10);

        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        display.textContent = minutes + ":" + seconds;

        // Vérifie si le temps est écoulé
        if (--timer < 0) {
            clearInterval(timerInterval);
            showEndMessage();
        }
    }, 1000);
}

// Fonction pour afficher le message de fin de test
function showEndMessage() {
    const blurBackground = document.createElement('div');
    blurBackground.id = 'test-end-blur';
    blurBackground.style.position = 'fixed';
    blurBackground.style.top = '0';
    blurBackground.style.left = '0';
    blurBackground.style.width = '100%';
    blurBackground.style.height = '100%';
    blurBackground.style.background = 'rgba(0, 0, 0, 0.5)';
    blurBackground.style.zIndex = '100';
    blurBackground.style.display = 'flex';
    blurBackground.style.alignItems = 'center';
    blurBackground.style.justifyContent = 'center';

    const endMessage = document.createElement('div');
    endMessage.id = 'test-end-message';
    endMessage.style.padding = '40px';
    endMessage.style.background = '#ffffff';
    endMessage.style.borderRadius = '8px';
    endMessage.style.textAlign = 'center';
    endMessage.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.2)';
    endMessage.innerHTML = '<h2>Test terminé</h2><p>Le temps imparti est écoulé.</p><button onclick="location.reload()">Recommencer</button>';

    blurBackground.appendChild(endMessage);
    document.body.appendChild(blurBackground);

    // Optionnel : masquer le conteneur de timer
    const timerContainer = document.getElementById('timer-container');
    timerContainer.classList.add('hide');
}


// Fonction pour réinitialiser une seule question
function resetQuestion(questionName) {
    const form = document.getElementById('quiz-form');
    const questionDiv = document.querySelector(`input[name="${questionName}"]`).closest('.question-container');

    // Décocher toutes les cases de cette question
    const inputs = form.elements[questionName];
    inputs.forEach(input => {
        input.checked = false;
    });

    // Supprimer les styles correct/incorrect et remettre les couleurs par défaut
    questionDiv.classList.remove('correct', 'incorrect');
    questionDiv.querySelectorAll('li').forEach(li => li.style.color = '');

    // Supprimer les informations enregistrées sur la réponse de cette question
    delete userAnswers[questionName];
}

// Fonction pour soumettre le quiz et afficher le résultat

// Fonction pour soumettre le quiz et afficher le résultat
async function submitQuiz() {
    console.log("Début de la soumission du quiz.");

    const form = document.getElementById('quiz-form');
    if (!form) {
        console.error("Erreur : Formulaire introuvable.");
        alert("Formulaire introuvable. Veuillez réessayer.");
        return;
    }

    let score = 0;

    // Évaluer les réponses utilisateur
    for (const question of Object.keys(correctAnswers)) {
        correctQuestion(question); // Fonction pour corriger chaque question
        const userAnswer = userAnswers[question]?.isCorrect;
        if (userAnswer) {
            score++;
        }
    }

    console.log("Score brut calculé (frontend) :", score);
    console.log("Réponses utilisateur envoyées :", userAnswers);

    // Lancer les confettis et afficher le message de félicitations si le score est parfait (50 sur 50)
    lancerConfettisEtMessage(score);

    // Mise à jour du résultat dans la boîte de dialogue
    const resultDiv = document.getElementById('result'); // Assure-toi que tu as un div avec l'id 'result' dans ton HTML

    if (score === 2) {
        // Liste des messages de félicitations
        const messages = [
            "Félicitations ! Vous êtes en bonne voie pour devenir un médecin brillant !",
            "Impressionnant ! Vous maîtrisez cette matière comme un vrai professionnel de santé.",
            "Excellent travail ! Votre dévouement à l'étude porte ses fruits.",
            "Bravo ! Vous êtes sur la bonne voie pour une brillante carrière médicale.",
            "Quel talent ! La précision dans vos réponses est remarquable.",
            "Incroyable ! Votre compréhension de l'anatomie est sans faille.",
            "Félicitations ! Vous avez prouvé que vous avez ce qu'il faut pour réussir dans le domaine médical.",
            "C'est parfait ! Vos connaissances sont solides comme un roc.",
            "Bravo ! Vous êtes un exemple de rigueur et de détermination.",
            "Vous êtes un prodige ! Ce score parfait montre à quel point vous êtes doué(e).",
            "Félicitations ! Vous serez un atout incroyable pour la médecine.",
            "Vous avez tout juste ! Vos compétences en anatomie sont impressionnantes.",
            "Parfait ! Vous êtes prêt(e) à affronter tous les défis médicaux.",
            "Vous avez réussi haut la main ! La médecine est définitivement votre domaine.",
            "Votre score est exemplaire ! Vous avez toutes les qualités d'un futur médecin.",
            "Extraordinaire ! Vous faites preuve d'une maîtrise remarquable.",
            "Un vrai sans-faute ! Continuez comme ça, vous allez faire des miracles dans la médecine.",
            "Bravo ! Vous avez prouvé que vous avez l'étoffe d'un grand médecin.",
            "Score parfait ! Votre engagement est tout simplement admirable.",
            "Incroyable ! Vous êtes destiné(e) à un avenir brillant dans la médecine."
        ];
        const randomMessage = messages[Math.floor(Math.random() * messages.length)];
        resultDiv.innerHTML = `<p>${randomMessage}</p>`;
    } else {
        resultDiv.innerHTML = `Vous avez obtenu ${score} bonnes réponses sur ${Object.keys(correctAnswers).length}.`;
    }

    // Afficher la boîte de résultat avec animation
    const resultPopup = document.getElementById('result-popup');
    const blurBackground = document.getElementById('blur-background');

    blurBackground.style.display = 'block';
    resultPopup.style.display = 'block';

    setTimeout(() => {
        blurBackground.classList.add('show'); // Ajoute l'animation de fondu sur le fond flouté
        resultPopup.classList.add('show'); // Ajoute l'animation de zoom sur la boîte de résultat
    }, 100); // Légère pause pour plus de fluidité

    document.getElementById('voir-detail-btn').style.display = 'inline-block';

    // Envoi des données au backend
    try {
        console.log("Préparation de l'enregistrement au backend...");

        const response = await fetch("/soumettre-quiz/", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": "{{ csrf_token }}" // Inclure le token CSRF
            },
            body: JSON.stringify({
                exam_name: "RdBP", // Remplacez par le nom réel de l'examen
                score: score,
                userAnswers: userAnswers
            })
        });

        const result = await response.json();
        if (response.ok) {
            console.log("Score enregistré avec succès :", result);
        } else {
            console.error("Erreur du serveur :", result.message);
            alert(`Erreur : ${result.message}`);
        }
    } catch (error) {
        console.error("Erreur lors de l'envoi des données :", error);
        alert("Une erreur s'est produite lors de la soumission. Veuillez réessayer.");
    }
}
function resetAll() {
    const form = document.getElementById('quiz-form');

    // Réinitialiser toutes les questions
    for (const question of Object.keys(correctAnswers)) {
        const questionDiv = document.querySelector(`input[name="${question}"]`).closest('.question-container');
        form.elements[question].forEach(input => {
            input.checked = false; // Décocher toutes les cases
        });

        // Supprimer les styles correct/incorrect
        questionDiv.classList.remove('correct', 'incorrect');
        questionDiv.querySelectorAll('li').forEach(li => li.style.color = '');
    }

    // Réinitialiser l'affichage du timer
    const timerDuration = 60 * 60; // Remettre à 60 minutes (ou 10 secondes pour le test)
    const display = document.querySelector('#timer');
    startTimer(timerDuration, display); // Redémarrer le timer

    // Masquer la boîte de résultat
    const resultPopup = document.getElementById('result-popup');
    const blurBackground = document.getElementById('blur-background');
    resultPopup.classList.remove('show');
    blurBackground.classList.remove('show');
    setTimeout(() => {
        resultPopup.style.display = 'none';
        blurBackground.style.display = 'none';
    }, 500);
	// Remonter en haut de la page
    window.scrollTo({ top: 0, behavior: 'smooth' });


    document.getElementById('voir-detail-btn').style.display = 'none'; // Masquer le bouton "Voir Détail"
}

// Fonction pour fermer la popup et garder les couleurs des bonnes/mauvaises réponses
function closeResult(event) {
    event.preventDefault(); // Empêche le comportement par défaut du bouton

    const resultPopup = document.getElementById('result-popup');
    const blurBackground = document.getElementById('blur-background');

    // Masquer la boîte de résultat
    resultPopup.classList.remove('show');
    blurBackground.classList.remove('show');
    setTimeout(() => {
        resultPopup.style.display = 'none';
        blurBackground.style.display = 'none';
    }, 500);

    // Décocher toutes les cases sans changer la couleur des bonnes/mauvaises réponses
    const form = document.getElementById('quiz-form');
    for (const question of Object.keys(correctAnswers)) {
        form.elements[question].forEach(input => {
            input.checked = false; // Décocher toutes les cases
        });
    }

    }
// Fonction pour afficher les détails et rediriger vers Syntanatomie2023
function afficherDetails(event) {
    event.preventDefault(); // Empêche le comportement par défaut du bouton
    saveUserAnswers(); // Enregistrer les réponses avant de quitter la page
    window.location.href = '{% url "dynamic_file" "S1" "Anatomie_1" "syntanat2019" %}'; // Redirection vers Syntanatomie2023
}

// Fonction pour défiler jusqu'à la question
function scrollToQuestion(questionNumber) {
    const questionDiv = document.querySelector(`.question-container:nth-of-type(${questionNumber})`);
    if (questionDiv) {
        questionDiv.scrollIntoView({ behavior: 'smooth' });
    }
}

function saveUserAnswers() {
    // Change la clé pour la version 2019
    localStorage.setItem('userAnswersAnatomie2019', JSON.stringify(userAnswers));
}



// Fonction pour afficher les confettis et ajouter le message de félicitations dans la popup de résultats
function lancerConfettisEtMessage(score) {
    if (score === 2) {
        // Lancer les confettis
        confetti({
            particleCount: 200,
            spread: 70,
            origin: { y: 0.6 },
            colors: ['#bb0000', '#ffffff'], // Couleurs de confettis
        });

        // Ajouter un message de félicitations à la boîte de résultat
        const resultDiv = document.getElementById('result');
        const felicitationMessage = `<p>Félicitations! Vous avez obtenu ${score} bonnes réponses. Vous serez un grand médecin !</p>`;
        
        // Ajouter le message à la fin du résultat
        resultDiv.innerHTML += felicitationMessage;
    }
}
// Partie favori pour Anatomie2019

// Tableau pour stocker les questions favorites, récupéré depuis le localStorage
let favoriteQuestions2019 = JSON.parse(localStorage.getItem('favoriteQuestions2019')) || [];
console.log('Favorite questions loaded from localStorage:', favoriteQuestions2019);

function toggleFavorite(event, questionNumber) {
    event.preventDefault(); // Empêche le rafraîchissement de la page

    const button = document.querySelector(`.favorite-button[data-question="${questionNumber}"]`);
    const questionContent = document.querySelector(`#question-${questionNumber}`).innerHTML; // Récupère le contenu HTML de la question

    // Vérifie si la question est déjà dans les favoris
    const isFavorited = favoriteQuestions2019.includes(questionNumber);

    if (isFavorited) {
        // Si elle est déjà favorisée, on la retire des favoris
        favoriteQuestions2019 = favoriteQuestions2019.filter(q => q !== questionNumber);
        button.classList.remove('favorited'); // Retire la classe favori
        localStorage.removeItem(`favoriteContent2019-${questionNumber}`); // Supprime le contenu de la question
    } else {
        // Si elle n'est pas favorisée, on l'ajoute
        favoriteQuestions2019.push(questionNumber);
        button.classList.add('favorited'); // Ajoute la classe favori
        localStorage.setItem(`favoriteContent2019-${questionNumber}`, questionContent); // Stocke le contenu de la question dans le localStorage
    }

    // Sauvegarde uniquement les favoris
    saveFavoriteState2019(); 

    // Mise à jour du bouton "Voir Favori" sans rafraîchir la page
    showFavoriteButton2019();
}

function saveFavoriteState2019() {
    localStorage.setItem('favoriteQuestions2019', JSON.stringify(favoriteQuestions2019)); // Sauvegarde les questions favorites
}

function initializeFavoriteButtons2019() {
    const allFavoriteButtons = document.querySelectorAll('.favorite-button');

    allFavoriteButtons.forEach(button => {
        const questionNumber = parseInt(button.getAttribute('data-question'), 10);

        // Vérifie si cette question est dans les favoris et applique la classe
        if (favoriteQuestions2019.includes(questionNumber)) {
            button.classList.add('favorited'); // Ajoute l'état favori
        } else {
            button.classList.remove('favorited'); // Retire l'état favori
        }

        // Ajoute un événement de clic pour chaque bouton et empêche le rafraîchissement
        button.addEventListener('click', (event) => toggleFavorite(event, questionNumber));
    });
}


function showFavoriteButton2019() {
    const voirFavorisBtn = document.getElementById('voir-favoris-btn');
    if (favoriteQuestions2019.length > 0) {
        voirFavorisBtn.style.display = 'inline-block'; // Affiche le bouton si des questions sont favorisées
    } else {
        voirFavorisBtn.style.display = 'none'; // Cache le bouton si aucun favori
    }
}

// Appelle cette fonction après avoir ajouté ou retiré des favoris
window.onload = function() {
    console.log('Page loaded, initializing favorite buttons for 2019.');

    initializeFavoriteButtons2019();  // Charger les boutons de favoris
    showFavoriteButton2019(); // Afficher le bouton "Voir Favori" si des favoris existent

    const timerDuration = 60 * 60; // 60 minutes
    const display = document.querySelector('#timer');
    startTimer(timerDuration, display);

    // Récupère toutes les listes (li) qui contiennent des propositions
    const propositions = document.querySelectorAll('li');

    propositions.forEach(function(proposition) {
        // Trouve la checkbox dans chaque liste
        const checkbox = proposition.querySelector('input[type="checkbox"]');
        if (checkbox) {
            // Créer un label
            const label = document.createElement('label');

            // Donner un id à la checkbox si elle n'en a pas
            if (!checkbox.id) {
                checkbox.id = checkbox.name + '-' + checkbox.value; // Ex: q1-A
            }

            // Déplacer le texte de la proposition dans le label
            label.htmlFor = checkbox.id; // Le 'for' du label correspond à l'id de la checkbox
            label.appendChild(checkbox); // Déplacer la checkbox dans le label
            label.appendChild(document.createTextNode(proposition.textContent.trim())); // Ajouter le texte de la proposition

            // Remplacer le contenu original par le nouveau label
            proposition.innerHTML = ''; // Vider le contenu de l'élément <li>
            proposition.appendChild(label); // Ajouter le label modifié
        }
    });
};

try {
    localStorage.setItem('testKey', 'testValue');
    const testValue = localStorage.getItem('testKey');
    if (testValue !== 'testValue') {
        console.error('localStorage is not functioning as expected.');
    }
} catch (error) {
    console.error('localStorage error:', error);
}

// Fonction pour rediriger vers la page des favoris
function voirFavoris2019() {
    window.location.href = '{% url "dynamic_file" "S1" "Anatomie_1" "../favori" %}'; // Redirection vers la page favori pour 2019
}

    </script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>

</body>
</html>
                // Réponses correctes pour les questions
                const correctAnswers = {
};


                // Contenu du fichier JavaScript
                // Variable globale pour stocker l'intervalle du timer
let timerInterval;
const userAnswers = {}; // Object pour stocker les réponses de l'utilisateur

// Fonction pour démarrer le timer
function startTimer(duration, display) {
    let timer = duration, minutes, seconds;

    timerInterval = setInterval(() => {
        minutes = parseInt(timer / 60, 10);
        seconds = parseInt(timer % 60, 10);

        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        display.textContent = minutes + ":" + seconds;

        // Vérifie si le temps est écoulé
        if (--timer < 0) {
            clearInterval(timerInterval);
            showEndMessage();
        }
    }, 1000);
}

// Fonction pour afficher le message de fin de test
function showEndMessage() {
    const blurBackground = document.createElement('div');
    blurBackground.id = 'test-end-blur';
    blurBackground.style.position = 'fixed';
    blurBackground.style.top = '0';
    blurBackground.style.left = '0';
    blurBackground.style.width = '100%';
    blurBackground.style.height = '100%';
    blurBackground.style.background = 'rgba(0, 0, 0, 0.5)';
    blurBackground.style.zIndex = '100';
    blurBackground.style.display = 'flex';
    blurBackground.style.alignItems = 'center';
    blurBackground.style.justifyContent = 'center';

    const endMessage = document.createElement('div');
    endMessage.id = 'test-end-message';
    endMessage.style.padding = '40px';
    endMessage.style.background = '#ffffff';
    endMessage.style.borderRadius = '8px';
    endMessage.style.textAlign = 'center';
    endMessage.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.2)';
    endMessage.innerHTML = '<h2>Test terminé</h2><p>Le temps imparti est écoulé.</p><button onclick="location.reload()">Recommencer</button>';

    blurBackground.appendChild(endMessage);
    document.body.appendChild(blurBackground);

    // Optionnel : masquer le conteneur de timer
    const timerContainer = document.getElementById('timer-container');
    timerContainer.classList.add('hide');
}


// Fonction pour réinitialiser une seule question
function resetQuestion(questionName) {
    const form = document.getElementById('quiz-form');
    const questionDiv = document.querySelector(`input[name="${questionName}"]`).closest('.question-container');

    // Décocher toutes les cases de cette question
    const inputs = form.elements[questionName];
    inputs.forEach(input => {
        input.checked = false;
    });

    // Supprimer les styles correct/incorrect et remettre les couleurs par défaut
    questionDiv.classList.remove('correct', 'incorrect');
    questionDiv.querySelectorAll('li').forEach(li => li.style.color = '');

    // Supprimer les informations enregistrées sur la réponse de cette question
    delete userAnswers[questionName];
}

// Fonction pour soumettre le quiz et afficher le résultat
function submitQuiz() {
    const form = document.getElementById('quiz-form');
    let score = 0;

    // Arrêter le timer lors de la soumission
    clearInterval(timerInterval);

    // Évaluer les réponses et afficher les bonnes/mauvaises réponses
    for (const question of Object.keys(correctAnswers)) {
        correctQuestion(question); // Appel à la fonction pour corriger chaque question

        // Si la réponse est correcte, augmenter le score
        if (userAnswers[question].isCorrect) {
            score++;
        }
    }

    // Lancer les confettis et afficher le message de félicitations si le score est parfait (50 sur 50)
    lancerConfettisEtMessage(score);

    // Mise à jour du résultat dans la boîte de dialogue
    const resultDiv = document.getElementById('result'); // Assure-toi que tu as un div avec l'id 'result' dans ton HTML

    if (score === 2) {
        // Liste des messages de félicitations
        const messages = [
            "Félicitations ! Vous êtes en bonne voie pour devenir un médecin brillant !",
            "Impressionnant ! Vous maîtrisez cette matière comme un vrai professionnel de santé.",
            "Excellent travail ! Votre dévouement à l'étude porte ses fruits.",
            "Bravo ! Vous êtes sur la bonne voie pour une brillante carrière médicale.",
            "Quel talent ! La précision dans vos réponses est remarquable.",
            "Incroyable ! Votre compréhension de l'anatomie est sans faille.",
            "Félicitations ! Vous avez prouvé que vous avez ce qu'il faut pour réussir dans le domaine médical.",
            "C'est parfait ! Vos connaissances sont solides comme un roc.",
            "Bravo ! Vous êtes un exemple de rigueur et de détermination.",
            "Vous êtes un prodige ! Ce score parfait montre à quel point vous êtes doué(e).",
            "Félicitations ! Vous serez un atout incroyable pour la médecine.",
            "Vous avez tout juste ! Vos compétences en anatomie sont impressionnantes.",
            "Parfait ! Vous êtes prêt(e) à affronter tous les défis médicaux.",
            "Vous avez réussi haut la main ! La médecine est définitivement votre domaine.",
            "Votre score est exemplaire ! Vous avez toutes les qualités d'un futur médecin.",
            "Extraordinaire ! Vous faites preuve d'une maîtrise remarquable.",
            "Un vrai sans-faute ! Continuez comme ça, vous allez faire des miracles dans la médecine.",
            "Bravo ! Vous avez prouvé que vous avez l'étoffe d'un grand médecin.",
            "Score parfait ! Votre engagement est tout simplement admirable.",
            "Incroyable ! Vous êtes destiné(e) à un avenir brillant dans la médecine."
        ];

        // Choisir un message aléatoire
        const randomMessage = messages[Math.floor(Math.random() * messages.length)];

        // Afficher le message choisi dans le résultat
        resultDiv.innerHTML = `<p>${randomMessage}</p>`;
    } else {
        // Afficher le score normal si le score est inférieur à 50
        resultDiv.innerHTML = `Vous avez obtenu ${score} bonnes réponses sur ${Object.keys(correctAnswers).length}.`;
    }

    // Afficher la boîte de résultat avec animation
    const resultPopup = document.getElementById('result-popup');
    const blurBackground = document.getElementById('blur-background');

    blurBackground.style.display = 'block';
    resultPopup.style.display = 'block';

    setTimeout(() => {
        blurBackground.classList.add('show'); // Ajoute l'animation de fondu sur le fond flouté
        resultPopup.classList.add('show'); // Ajoute l'animation de zoom sur la boîte de résultat
    }, 100); // Légère pause pour plus de fluidité

    document.getElementById('voir-detail-btn').style.display = 'inline-block';
}

// Fonction pour réinitialiser toutes les questions et redémarrer le quiz
function resetAll() {
    const form = document.getElementById('quiz-form');

    // Réinitialiser toutes les questions
    for (const question of Object.keys(correctAnswers)) {
        const questionDiv = document.querySelector(`input[name="${question}"]`).closest('.question-container');
        form.elements[question].forEach(input => {
            input.checked = false; // Décocher toutes les cases
        });

        // Supprimer les styles correct/incorrect
        questionDiv.classList.remove('correct', 'incorrect');
        questionDiv.querySelectorAll('li').forEach(li => li.style.color = '');
    }

    // Réinitialiser l'affichage du timer
    const timerDuration = 60 * 60; // Remettre à 60 minutes (ou 10 secondes pour le test)
    const display = document.querySelector('#timer');
    startTimer(timerDuration, display); // Redémarrer le timer

    // Masquer la boîte de résultat
    const resultPopup = document.getElementById('result-popup');
    const blurBackground = document.getElementById('blur-background');
    resultPopup.classList.remove('show');
    blurBackground.classList.remove('show');
    setTimeout(() => {
        resultPopup.style.display = 'none';
        blurBackground.style.display = 'none';
    }, 500);
	// Remonter en haut de la page
    window.scrollTo({ top: 0, behavior: 'smooth' });


    document.getElementById('voir-detail-btn').style.display = 'none'; // Masquer le bouton "Voir Détail"
}

// Fonction pour fermer la popup et garder les couleurs des bonnes/mauvaises réponses
function closeResult(event) {
    event.preventDefault(); // Empêche le comportement par défaut du bouton

    const resultPopup = document.getElementById('result-popup');
    const blurBackground = document.getElementById('blur-background');

    // Masquer la boîte de résultat
    resultPopup.classList.remove('show');
    blurBackground.classList.remove('show');
    setTimeout(() => {
        resultPopup.style.display = 'none';
        blurBackground.style.display = 'none';
    }, 500);

    // Décocher toutes les cases sans changer la couleur des bonnes/mauvaises réponses
    const form = document.getElementById('quiz-form');
    for (const question of Object.keys(correctAnswers)) {
        form.elements[question].forEach(input => {
            input.checked = false; // Décocher toutes les cases
        });
    }

    }
// Fonction pour afficher les détails et rediriger vers Syntanatomie2023
function afficherDetails(event) {
    event.preventDefault(); // Empêche le comportement par défaut du bouton
    saveUserAnswers(); // Enregistrer les réponses avant de quitter la page
    window.location.href = '{% url "dynamic_file" "S1" "Anatomie_1" "syntanat2019" %}'; // Redirection vers Syntanatomie2023
}

// Fonction pour défiler jusqu'à la question
function scrollToQuestion(questionNumber) {
    const questionDiv = document.querySelector(`.question-container:nth-of-type(${questionNumber})`);
    if (questionDiv) {
        questionDiv.scrollIntoView({ behavior: 'smooth' });
    }
}

function saveUserAnswers() {
    // Change la clé pour la version 2019
    localStorage.setItem('userAnswersAnatomie2019', JSON.stringify(userAnswers));
}



// Fonction pour afficher les confettis et ajouter le message de félicitations dans la popup de résultats
function lancerConfettisEtMessage(score) {
    if (score === 2) {
        // Lancer les confettis
        confetti({
            particleCount: 200,
            spread: 70,
            origin: { y: 0.6 },
            colors: ['#bb0000', '#ffffff'], // Couleurs de confettis
        });

        // Ajouter un message de félicitations à la boîte de résultat
        const resultDiv = document.getElementById('result');
        const felicitationMessage = `<p>Félicitations! Vous avez obtenu ${score} bonnes réponses. Vous serez un grand médecin !</p>`;
        
        // Ajouter le message à la fin du résultat
        resultDiv.innerHTML += felicitationMessage;
    }
}
// Partie favori pour Anatomie2019

// Tableau pour stocker les questions favorites, récupéré depuis le localStorage
let favoriteQuestions2019 = JSON.parse(localStorage.getItem('favoriteQuestions2019')) || [];
console.log('Favorite questions loaded from localStorage:', favoriteQuestions2019);

function toggleFavorite(event, questionNumber) {
    event.preventDefault(); // Empêche le rafraîchissement de la page

    const button = document.querySelector(`.favorite-button[data-question="${questionNumber}"]`);
    const questionContent = document.querySelector(`#question-${questionNumber}`).innerHTML; // Récupère le contenu HTML de la question

    // Vérifie si la question est déjà dans les favoris
    const isFavorited = favoriteQuestions2019.includes(questionNumber);

    if (isFavorited) {
        // Si elle est déjà favorisée, on la retire des favoris
        favoriteQuestions2019 = favoriteQuestions2019.filter(q => q !== questionNumber);
        button.classList.remove('favorited'); // Retire la classe favori
        localStorage.removeItem(`favoriteContent2019-${questionNumber}`); // Supprime le contenu de la question
    } else {
        // Si elle n'est pas favorisée, on l'ajoute
        favoriteQuestions2019.push(questionNumber);
        button.classList.add('favorited'); // Ajoute la classe favori
        localStorage.setItem(`favoriteContent2019-${questionNumber}`, questionContent); // Stocke le contenu de la question dans le localStorage
    }

    // Sauvegarde uniquement les favoris
    saveFavoriteState2019(); 

    // Mise à jour du bouton "Voir Favori" sans rafraîchir la page
    showFavoriteButton2019();
}

function saveFavoriteState2019() {
    localStorage.setItem('favoriteQuestions2019', JSON.stringify(favoriteQuestions2019)); // Sauvegarde les questions favorites
}

function initializeFavoriteButtons2019() {
    const allFavoriteButtons = document.querySelectorAll('.favorite-button');

    allFavoriteButtons.forEach(button => {
        const questionNumber = parseInt(button.getAttribute('data-question'), 10);

        // Vérifie si cette question est dans les favoris et applique la classe
        if (favoriteQuestions2019.includes(questionNumber)) {
            button.classList.add('favorited'); // Ajoute l'état favori
        } else {
            button.classList.remove('favorited'); // Retire l'état favori
        }

        // Ajoute un événement de clic pour chaque bouton et empêche le rafraîchissement
        button.addEventListener('click', (event) => toggleFavorite(event, questionNumber));
    });
}


function showFavoriteButton2019() {
    const voirFavorisBtn = document.getElementById('voir-favoris-btn');
    if (favoriteQuestions2019.length > 0) {
        voirFavorisBtn.style.display = 'inline-block'; // Affiche le bouton si des questions sont favorisées
    } else {
        voirFavorisBtn.style.display = 'none'; // Cache le bouton si aucun favori
    }
}

// Appelle cette fonction après avoir ajouté ou retiré des favoris
window.onload = function() {
    console.log('Page loaded, initializing favorite buttons for 2019.');

    initializeFavoriteButtons2019();  // Charger les boutons de favoris
    showFavoriteButton2019(); // Afficher le bouton "Voir Favori" si des favoris existent

    const timerDuration = 60 * 60; // 60 minutes
    const display = document.querySelector('#timer');
    startTimer(timerDuration, display);

    // Récupère toutes les listes (li) qui contiennent des propositions
    const propositions = document.querySelectorAll('li');

    propositions.forEach(function(proposition) {
        // Trouve la checkbox dans chaque liste
        const checkbox = proposition.querySelector('input[type="checkbox"]');
        if (checkbox) {
            // Créer un label
            const label = document.createElement('label');

            // Donner un id à la checkbox si elle n'en a pas
            if (!checkbox.id) {
                checkbox.id = checkbox.name + '-' + checkbox.value; // Ex: q1-A
            }

            // Déplacer le texte de la proposition dans le label
            label.htmlFor = checkbox.id; // Le 'for' du label correspond à l'id de la checkbox
            label.appendChild(checkbox); // Déplacer la checkbox dans le label
            label.appendChild(document.createTextNode(proposition.textContent.trim())); // Ajouter le texte de la proposition

            // Remplacer le contenu original par le nouveau label
            proposition.innerHTML = ''; // Vider le contenu de l'élément <li>
            proposition.appendChild(label); // Ajouter le label modifié
        }
    });
};

try {
    localStorage.setItem('testKey', 'testValue');
    const testValue = localStorage.getItem('testKey');
    if (testValue !== 'testValue') {
        console.error('localStorage is not functioning as expected.');
    }
} catch (error) {
    console.error('localStorage error:', error);
}

// Fonction pour rediriger vers la page des favoris
function voirFavoris2019() {
    window.location.href = '{% url "dynamic_file" "S1" "Anatomie_1" "../favori" %}'; // Redirection vers la page favori pour 2019
}

    </script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>

</body>
</html>

            </script>
        </form>
        </div>
    </body>
    </html>
    
// Fonction pour corriger une question 
function correctQuestion(questionName) {
    const form = document.getElementById('quiz-form');
    const questionDiv = document.querySelector(`input[name="${questionName}"]`).closest('.question-container');
    const selected = Array.from(form.elements[questionName]).filter(input => input.checked).map(input => input.value);

    // Calculer si la réponse est correcte
    const isCorrect = JSON.stringify(correctAnswers[questionName].sort()) === JSON.stringify(selected.sort());

    // Enregistre si la réponse est correcte ou incorrecte
    userAnswers[questionName] = {
        selected: selected,
        isCorrect: isCorrect
    };

    // Supprimer les styles précédents
    questionDiv.classList.remove('correct', 'incorrect');
    questionDiv.querySelectorAll('li').forEach(li => li.style.color = '');

    // Applique les couleurs selon la validité des réponses
    questionDiv.querySelectorAll('li').forEach(li => {
        const isChoiceCorrect = correctAnswers[questionName].includes(li.querySelector('input').value);
        const isSelected = selected.includes(li.querySelector('input').value);

        if (isChoiceCorrect) {
            // Appliquer le style vert aux bonnes réponses
            li.style.color = 'green';
            li.style.fontWeight = 'bold';
            li.style.textShadow = '1px 1px 2px rgba(0, 128, 0, 0.7)';
            li.style.backgroundColor = 'transparent'; // Remettre le fond transparent
            li.style.border = 'none'; // Supprimer la bordure
        }

        if (isSelected && !isChoiceCorrect) {
            // Appliquer le style rouge pour les mauvaises réponses sélectionnées
            li.style.color = 'red';
        }
    });

    console.log(`Début de la correction pour la question ${questionName}`);
    console.log(`Réponses sélectionnées pour ${questionName}: ${selected.join(', ')}`);
    console.log(`Résultat pour ${questionName}: ${isCorrect ? 'Correct' : 'Incorrect'}`);

    // Déterminer le nom de l'examen et l'ID complet de la question
    const examNameElement = document.getElementById('exam_name');

    // Construire les IDs complets des choix
    const examName = examNameElement.value; // Nom de l'examen (par exemple, Anatomie2023)
    const fullChoiceIds = selected.map(choice => `${examName}_${questionName.substring(1)}_${choice.toLowerCase()}`);
    console.log(`IDs complets générés pour les choix : ${fullChoiceIds.join(', ')}`);

   // Envoyer les données au serveur
    fetch('/track_attempts/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({
            question_name: questionName, // Nom unique de la question (q22, etc.)
            full_choice_ids: fullChoiceIds // IDs complets générés (par exemple : Anatomie2023_22_c)
        })
    })
        .then(response => response.json())
        .then(data => {
            console.log(`Données reçues du serveur : ${JSON.stringify(data)}`);

            // Mettre à jour l'état visuel des réponses correctes ou incorrectes
            if (data.is_correct) {
                console.log(`La réponse pour ${questionName} est correcte.`);
            } else {
                console.log(`La réponse pour ${questionName} est incorrecte.`);
            }

            // Supprimer les anciennes alertes et gérer les nouvelles si nécessaire
            handleAlert(data.alert, questionDiv);

            // Mettre à jour les statistiques comme les taux d'échec
            updateStatisticalAlerts(data, questionDiv);
        })
        .catch(error => {
            console.error('Erreur lors de l'envoi des résultats au serveur :', error);
        });
}


<script>
// Fonction pour corriger une question
function correctQuestion(questionName) {
    const form = document.getElementById('quiz-form');
    const questionDiv = document.querySelector(`input[name="${questionName}"]`).closest('.question-container');
    const selected = Array.from(form.elements[questionName]).filter(input => input.checked).map(input => input.value);

    // Calculer si la réponse est correcte
    const isCorrect = JSON.stringify(correctAnswers[questionName].sort()) === JSON.stringify(selected.sort());

    // Enregistre si la réponse est correcte ou incorrecte
    userAnswers[questionName] = {
        selected: selected,
        isCorrect: isCorrect
    };

    // Supprimer les styles précédents
    questionDiv.classList.remove('correct', 'incorrect');
    questionDiv.querySelectorAll('li').forEach(li => li.style.color = '');

    // Applique les couleurs selon la validité des réponses
    questionDiv.querySelectorAll('li').forEach(li => {
        const isChoiceCorrect = correctAnswers[questionName].includes(li.querySelector('input').value);
        const isSelected = selected.includes(li.querySelector('input').value);

        if (isChoiceCorrect) {
            // Appliquer le style vert aux bonnes réponses
            li.style.color = 'green';
            li.style.fontWeight = 'bold';
            li.style.textShadow = '1px 1px 2px rgba(0, 128, 0, 0.7)';
        }

        if (isSelected && !isChoiceCorrect) {
            // Appliquer le style rouge pour les mauvaises réponses sélectionnées
            li.style.color = 'red';
        }
    });

    console.log(`Début de la correction pour la question ${questionName}`);
    console.log(`Réponses sélectionnées pour ${questionName}: ${selected.join(', ')}`);
    console.log(`Résultat pour ${questionName}: ${isCorrect ? 'Correct' : 'Incorrect'}`);

    // Déterminer le nom de l'examen et l'ID complet de la question
    const examNameElement = document.getElementById('exam_name');
    const examName = examNameElement.value; // Nom de l'examen (par exemple, Anatomie2023)
    const fullChoiceIds = selected.map(choice => `${examName}_${questionName.substring(1)}_${choice.toLowerCase()}`);
    console.log(`IDs complets générés pour les choix : ${fullChoiceIds.join(', ')}`);

    // Envoyer les données au serveur
    fetch('/track_attempts/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({
            question_name: questionName,
            full_choice_ids: fullChoiceIds
        })
    })
        .then(response => response.json())
        .then(data => {
            console.log(`Données reçues du serveur : ${JSON.stringify(data)}`);
            handleAlert(data.alert, questionDiv);
            updateStatisticalAlerts(data, questionDiv);
        })
        .catch(error => console.error('Erreur lors de l’envoi des données:', error));
}

// Fonction pour gérer les alertes
function handleAlert(alertData, questionDiv) {
    const existingAlert = questionDiv.querySelector('.alert-indicator');
    if (existingAlert) {
        existingAlert.remove();
    }

    if (alertData) {
        const alertIndicator = document.createElement('div');
        alertIndicator.className = 'alert-indicator';
        alertIndicator.style.backgroundColor = alertData.color || '#f8d7da';
        alertIndicator.style.padding = '10px';
        alertIndicator.style.marginTop = '10px';
        alertIndicator.style.borderRadius = '5px';
        alertIndicator.style.fontWeight = 'bold';
        alertIndicator.style.color = '#721c24';
        alertIndicator.style.boxShadow = '0 2px 5px rgba(0, 0, 0, 0.1)';
        alertIndicator.textContent = alertData.message;

        questionDiv.appendChild(alertIndicator);
        saveAlertToLocalStorage(questionDiv.getAttribute('data-question-id'), alertData);
    } else {
        removeAlertFromLocalStorage(questionDiv.getAttribute('data-question-id'));
    }
}

// Charger les alertes persistantes
function loadAlertsFromLocalStorage() {
    const storedAlerts = JSON.parse(localStorage.getItem('alerts')) || {};
    Object.keys(storedAlerts).forEach(questionId => {
        const questionDiv = document.querySelector(`.question-container[data-question-id="${questionId}"]`);
        if (questionDiv) {
            handleAlert(storedAlerts[questionId], questionDiv);
        }
    });
}

// Sauvegarder les alertes dans localStorage
function saveAlertToLocalStorage(questionId, alertData) {
    const storedAlerts = JSON.parse(localStorage.getItem('alerts')) || {};
    storedAlerts[questionId] = alertData;
    localStorage.setItem('alerts', JSON.stringify(storedAlerts));
}

// Supprimer une alerte de localStorage
function removeAlertFromLocalStorage(questionId) {
    const storedAlerts = JSON.parse(localStorage.getItem('alerts')) || {};
    delete storedAlerts[questionId];
    localStorage.setItem('alerts', JSON.stringify(storedAlerts));
}

// Mise à jour des alertes statistiques
function updateStatisticalAlerts(data, questionDiv) {
    const existingStatisticalAlerts = questionDiv.querySelectorAll('.statistical-alert');
    existingStatisticalAlerts.forEach(alert => alert.remove());

    if (data.failure_rate > 0.6) {
        const failureRateAlert = document.createElement('div');
        failureRateAlert.className = 'statistical-alert';
        failureRateAlert.style.backgroundColor = '#add8e6';
        failureRateAlert.style.padding = '10px';
        failureRateAlert.style.marginTop = '10px';
        failureRateAlert.style.borderRadius = '5px';
        failureRateAlert.style.fontWeight = 'bold';
        failureRateAlert.style.color = '#004085';
        failureRateAlert.style.boxShadow = '0 2px 5px rgba(0, 0, 0, 0.1)';
        failureRateAlert.textContent = `🔵 Votre taux d'échec est de ${(data.failure_rate * 100).toFixed(0)}%. Revoir cette question est conseillé.`;

        questionDiv.appendChild(failureRateAlert);
    }
}

// Charger les alertes au démarrage
document.addEventListener('DOMContentLoaded', () => {
    loadAlertsFromLocalStorage();
});

</script>
