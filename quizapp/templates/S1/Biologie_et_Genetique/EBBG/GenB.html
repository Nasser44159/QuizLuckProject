
    <!DOCTYPE html>
    <html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Quiz Luck</title>
        <link rel="stylesheet" href="stylequiz.css">
    </head>
    <body>
        <div class="container">
            <div class="quiz-title">
                <h1>QCM Anatomie 1</h1>
            </div>
            <form id="quiz-form">
    <input type="hidden" id='exam_name' name="exam_name" value="GenB">
    {% csrf_token %}>
    
        <div id="question-1" class="question-container">
            <div class="question">
                <p>1.) Une mutation qui affecte une cellule somatique :</p>
                <ul>
        
                    <li><input type="checkbox" id="q1a" name="q1" value="A"> A- A. Est transmise aux cellules-filles.</li>
            
                    <li><input type="checkbox" id="q1b" name="q1" value="B"> B- B. Est toujours mortelle pour la cellule.</li>
            
                    <li><input type="checkbox" id="q1c" name="q1" value="C"> C- C. Est transmise aux descendants après fécondation.</li>
            
                    <li><input type="checkbox" id="q1d" name="q1" value="D"> D- D. Est due à un facteur de l’environnement.</li>
            
                    <li><input type="checkbox" id="q1e" name="q1" value="E"> E- E. Affecte également la lignée germinale.</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q1')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q1')">Réessayer</button>
                <button class="favorite-button" data-question="1">&#10084;</button>
            </div>
        </div>
        
        <div id="question-2" class="question-container">
            <div class="question">
                <p>2.) Les cellules les plus utilisées pour la réalisation d’un caryotype métaphasique sont :</p>
                <ul>
        
                    <li><input type="checkbox" id="q2a" name="q2" value="A"> A- A. Les fibroblastes</li>
            
                    <li><input type="checkbox" id="q2b" name="q2" value="B"> B- B. Les cellules amniotiques</li>
            
                    <li><input type="checkbox" id="q2c" name="q2" value="C"> C- C. Les lymphocytes sanguins</li>
            
                    <li><input type="checkbox" id="q2d" name="q2" value="D"> D- D. Les cellules du trophoblaste</li>
            
                    <li><input type="checkbox" id="q2e" name="q2" value="E"> E- E. Le tissu tumoral</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q2')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q2')">Réessayer</button>
                <button class="favorite-button" data-question="2">&#10084;</button>
            </div>
        </div>
        
        <div id="question-3" class="question-container">
            <div class="question">
                <p>3.) L’hérédité autosomique récessive :</p>
                <ul>
        
                    <li><input type="checkbox" id="q3a" name="q3" value="A"> A- A. S’exprime à l’état hétérozygote.</li>
            
                    <li><input type="checkbox" id="q3b" name="q3" value="B"> B- B. S’exprime à l’état homozygote.</li>
            
                    <li><input type="checkbox" id="q3c" name="q3" value="C"> C- C. Est plus fréquente dans les populations consanguines.</li>
            
                    <li><input type="checkbox" id="q3d" name="q3" value="D"> D- D. Apparaît typiquement chez plus d’un membre d’une même génération : transmission horizontale.</li>
            
                    <li><input type="checkbox" id="q3e" name="q3" value="E"> E- E. Apparaît typiquement chez plus d’un membre d’une même génération : transmission verticale.</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q3')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q3')">Réessayer</button>
                <button class="favorite-button" data-question="3">&#10084;</button>
            </div>
        </div>
        
        <div id="question-4" class="question-container">
            <div class="question">
                <p>4.) L’acétylation des histones chez les eucaryotes :</p>
                <ul>
        
                    <li><input type="checkbox" id="q4a" name="q4" value="A"> A- A. Est un contrôle pré-transcriptionnel</li>
            
                    <li><input type="checkbox" id="q4b" name="q4" value="B"> B- B. Est une addition d’un groupement acétyles sur les histones</li>
            
                    <li><input type="checkbox" id="q4c" name="q4" value="C"> C- C. Permet inactivation des gènes</li>
            
                    <li><input type="checkbox" id="q4d" name="q4" value="D"> D- D. La désacétylation des histones est associée, en général, à la répression des gènes par la formation de l’hétérochromatine</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q4')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q4')">Réessayer</button>
                <button class="favorite-button" data-question="4">&#10084;</button>
            </div>
        </div>
        
        <div id="question-5" class="question-container">
            <div class="question">
                <p>5.) Parmi les propositions relatives à la PCR, lesquelles sont exactes ?</p>
                <ul>
        
                    <li><input type="checkbox" id="q5a" name="q5" value="A"> A- A. C’est une technique d’amplification de l’ADN in vitro.</li>
            
                    <li><input type="checkbox" id="q5b" name="q5" value="B"> B- B. Elle nécessite l’utilisation d’amorces d’ARN.</li>
            
                    <li><input type="checkbox" id="q5c" name="q5" value="C"> C- C. Elle nécessite la répétition de cycles alternant dénaturation, hybridation et polymérisation.</li>
            
                    <li><input type="checkbox" id="q5d" name="q5" value="D"> D- D. Elle nécessite une polymérase thermostable.</li>
            
                    <li><input type="checkbox" id="q5e" name="q5" value="E"> E- E. Elle permet d’amplifier un fragment d’ADN pouvant atteindre 1 Mb.</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q5')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q5')">Réessayer</button>
                <button class="favorite-button" data-question="5">&#10084;</button>
            </div>
        </div>
        
        <div id="question-6" class="question-container">
            <div class="question">
                <p>6.) En consultation génétique un enfant présente des malformations cardiaques, une dysmorphie faciale, un retard du développement psychomoteur avec déficience intellectuelle, des troubles du comportement, des difficultés d’élocution. Vous évoquez le Syndrome de DiGeorge (Syndrome de la délétion 22q11.2) Pour confirmer votre suspicion, vous prescrivez :</p>
                <ul>
        
                    <li><input type="checkbox" id="q6a" name="q6" value="A"> A- A. Un séquençage de tout le génome</li>
            
                    <li><input type="checkbox" id="q6b" name="q6" value="B"> B- B. Un caryotype constitutionnel sur lymphocytes</li>
            
                    <li><input type="checkbox" id="q6c" name="q6" value="C"> C- C. Une FISH avec des sondes ‘Sonde 22q11.2 et Sonde 22q13’</li>
            
                    <li><input type="checkbox" id="q6d" name="q6" value="D"> D- D. Une PCR en temps réel</li>
            
                    <li><input type="checkbox" id="q6e" name="q6" value="E"> E- E. Une numération formule sanguine NFS.</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q6')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q6')">Réessayer</button>
                <button class="favorite-button" data-question="6">&#10084;</button>
            </div>
        </div>
        
        <div id="question-7" class="question-container">
            <div class="question">
                <p>7.) La réplication</p>
                <ul>
        
                    <li><input type="checkbox" id="q7a" name="q7" value="A"> A- A. Est bidirectionnelle</li>
            
                    <li><input type="checkbox" id="q7b" name="q7" value="B"> B- B. Peut donc se faire de 5’ vers 3’ et de 3’ vers 5’</li>
            
                    <li><input type="checkbox" id="q7c" name="q7" value="C"> C- C. Respecte la règle de complémentarité des bases</li>
            
                    <li><input type="checkbox" id="q7d" name="q7" value="D"> D- D. Synthétise un brin parallèle au brin qui sert de matrice</li>
            
                    <li><input type="checkbox" id="q7e" name="q7" value="E"> E- E. Utilise les deux brins parentaux pour synthétiser deux molécules-fille d’ADN</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q7')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q7')">Réessayer</button>
                <button class="favorite-button" data-question="7">&#10084;</button>
            </div>
        </div>
        
        <div id="question-8" class="question-container">
            <div class="question">
                <p>8.) Parmi les affirmations suivantes, relevez-la (ou les) proposition(s) exacte(s). La réplication est toujours :</p>
                <ul>
        
                    <li><input type="checkbox" id="q8a" name="q8" value="A"> A- A. Unidirectionnelle</li>
            
                    <li><input type="checkbox" id="q8b" name="q8" value="B"> B- B. Semi-conservative</li>
            
                    <li><input type="checkbox" id="q8c" name="q8" value="C"> C- C. Réalisée à partir de plusieurs points d’initiation (les yeux de réplication)</li>
            
                    <li><input type="checkbox" id="q8d" name="q8" value="D"> D- D. Associée à une polymérisation des nucléotides se réalisant dans le sens 3’->5’</li>
            
                    <li><input type="checkbox" id="q8e" name="q8" value="E"> E- E. Discontinue pour l’un des brins.</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q8')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q8')">Réessayer</button>
                <button class="favorite-button" data-question="8">&#10084;</button>
            </div>
        </div>
        
        <div id="question-9" class="question-container">
            <div class="question">
                <p>9.) Les protéines SSB (Single Strand Binding) :</p>
                <ul>
        
                    <li><input type="checkbox" id="q9a" name="q9" value="A"> A- A. Permettent le passage de l’ADN d’un état super enroulé, provoqué par la progression de la fourche de réplication</li>
            
                    <li><input type="checkbox" id="q9b" name="q9" value="B"> B- B. Déroulent et séparent les deux brins d’ADN</li>
            
                    <li><input type="checkbox" id="q9c" name="q9" value="C"> C- C. Elles permettent de modifier l’enroulement des deux brins en hydrolysant un brin d’ADN et en reconnaissant après un tour accompli de l’ADN super enroulé</li>
            
                    <li><input type="checkbox" id="q9d" name="q9" value="D"> D- D. Ce sont des protéines qui stabilisent les deux brins lors de la réplication.</li>
            
                    <li><input type="checkbox" id="q9e" name="q9" value="E"> E- E. Effectuent la soudure des deux brins d’ADN ou des fragments d’Okazaki</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q9')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q9')">Réessayer</button>
                <button class="favorite-button" data-question="9">&#10084;</button>
            </div>
        </div>
        
        <div id="question-10" class="question-container">
            <div class="question">
                <p>10.) Les topo-isomérases (enzymes de la réplication) :</p>
                <ul>
        
                    <li><input type="checkbox" id="q10a" name="q10" value="A"> A- A. Déroulent et séparent les deux brins d’ADN, ceci conduit à une structure en Y appelée fourche de réplication.</li>
            
                    <li><input type="checkbox" id="q10b" name="q10" value="B"> B- B. Effectuent la soudure du brin d’ADN entre deux fragments adjacents.</li>
            
                    <li><input type="checkbox" id="q10c" name="q10" value="C"> C- C. Maintiennent séparés les deux brins d’ADN.</li>
            
                    <li><input type="checkbox" id="q10d" name="q10" value="D"> D- D. Permettent le passage de l’ADN d’un état super enroulé, provoqué par la progression de la fourche de réplication, à des formes isomères de moindre tension.</li>
            
                    <li><input type="checkbox" id="q10e" name="q10" value="E"> E- E. Synthétisent le primer ou amorce et font partie d’un complexe protéique appelé primosome.</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q10')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q10')">Réessayer</button>
                <button class="favorite-button" data-question="10">&#10084;</button>
            </div>
        </div>
        
        <div id="question-11" class="question-container">
            <div class="question">
                <p>11.) Pour subir des maturation l’ARN messager immature subit des étapes de maturation. Parmi les affirmations suivantes, relevez-la (ou les) proposition(s) inexacte(s).</p>
                <ul>
        
                    <li><input type="checkbox" id="q11a" name="q11" value="A"> A- A. L’ajout d’une séquence polyadénylée en 3’</li>
            
                    <li><input type="checkbox" id="q11b" name="q11" value="B"> B- B. L’ajout d’un cap en 5’ au début de la transcription</li>
            
                    <li><input type="checkbox" id="q11c" name="q11" value="C"> C- C. La polyadénylation d’un poly A en 3’ à la fin de la transcription</li>
            
                    <li><input type="checkbox" id="q11d" name="q11" value="D"> D- D. L’épissage introns/exons</li>
            
                    <li><input type="checkbox" id="q11e" name="q11" value="E"> E- E. L’épissage alternatif des introns en 3’</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q11')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q11')">Réessayer</button>
                <button class="favorite-button" data-question="11">&#10084;</button>
            </div>
        </div>
        
        <div id="question-12" class="question-container">
            <div class="question">
                <p>12.) Dans la liste suivante, relevez les propositions exactes :</p>
                <ul>
        
                    <li><input type="checkbox" id="q12a" name="q12" value="A"> A- A. La terminaison de la transcription se lie à la région promotrice qui est composée de 3 boîtes :</li>
            
                    <li><input type="checkbox" id="q12b" name="q12" value="B"> B- B. L’épissage de l’ARN pré-messager se fait par complémentarité du brin transcrit</li>
            
                    <li><input type="checkbox" id="q12c" name="q12" value="C"> C- C. Au cours de la transcription, l’addition du coiffe 5’ -7 méthylguanosine se fait à l’extrémité 5’ de l’ARNm</li>
            
                    <li><input type="checkbox" id="q12d" name="q12" value="D"> D- D. L’épissage enlève la redondance des introns</li>
            
                    <li><input type="checkbox" id="q12e" name="q12" value="E"> E- E. L’ARN messager mature est la copie en exon de l’ADN.</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q12')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q12')">Réessayer</button>
                <button class="favorite-button" data-question="12">&#10084;</button>
            </div>
        </div>
        
        <div id="question-13" class="question-container">
            <div class="question">
                <p>13.) La traduction de l'ARNm mature en protéine</p>
                <ul>
        
                    <li><input type="checkbox" id="q13a" name="q13" value="A"> A- La traduction est un processus qui permet la synthèse des protéines à partir d'un ARNm pré-messager</li>
            
                    <li><input type="checkbox" id="q13b" name="q13" value="B"> B- Pour la synthèse des protéines, l'ARN messager mature est utilisé comme matrice</li>
            
                    <li><input type="checkbox" id="q13c" name="q13" value="C"> C- La traduction commence au codon initiateur (AUG) et se termine au codon stop (UAA, UGA et UAG)</li>
            
                    <li><input type="checkbox" id="q13d" name="q13" value="D"> D- Pour la synthèse des protéines, on besoin de l'ARNm, des ribosomes et d'ARNt</li>
            
                    <li><input type="checkbox" id="q13e" name="q13" value="E"> E- Les ribosomes se déplacent sur le mRNA dans le sens 3'->5'</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q13')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q13')">Réessayer</button>
                <button class="favorite-button" data-question="13">&#10084;</button>
            </div>
        </div>
        
        <div id="question-14" class="question-container">
            <div class="question">
                <p>14.) Parmi ces affirmations sur les ribosomes, lesquelles sont vraies ?</p>
                <ul>
        
                    <li><input type="checkbox" id="q14a" name="q14" value="A"> A- L'ARNm interagit d'abord avec la petite sous-unité du ribosome puis la grande vient se positionner</li>
            
                    <li><input type="checkbox" id="q14b" name="q14" value="B"> B- L'élongation de la protéine s'effectue par transfert de l'acide aminé de l'ARNt au site A du ribosome sur la chaîne peptidique liée à l'ARN au site P</li>
            
                    <li><input type="checkbox" id="q14c" name="q14" value="C"> C- La progression des ribosomes sur l'ARN se fait de 5' vers 3'</li>
            
                    <li><input type="checkbox" id="q14d" name="q14" value="D"> D- À un instant donné un ARNm peut être en contact avec deux ARNt dans un même ribosome</li>
            
                    <li><input type="checkbox" id="q14e" name="q14" value="E"> E- Le peptidyl transférase est une activité enzymatique présente dans la grande sous-unité ribosomale</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q14')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q14')">Réessayer</button>
                <button class="favorite-button" data-question="14">&#10084;</button>
            </div>
        </div>
        
        <div id="question-15" class="question-container">
            <div class="question">
                <p>15.) Un des codons pour l'acide aminé glutamique est CAG. Un des anticodons d'ARNt possible (écrit dans le sens 5' vers 3') est</p>
                <ul>
        
                    <li><input type="checkbox" id="q15a" name="q15" value="A"> A- CUI</li>
            
                    <li><input type="checkbox" id="q15b" name="q15" value="B"> B- GUC</li>
            
                    <li><input type="checkbox" id="q15c" name="q15" value="C"> C- GTC</li>
            
                    <li><input type="checkbox" id="q15d" name="q15" value="D"> D- CUG</li>
            
                    <li><input type="checkbox" id="q15e" name="q15" value="E"> E- GTC</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q15')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q15')">Réessayer</button>
                <button class="favorite-button" data-question="15">&#10084;</button>
            </div>
        </div>
        
        <div id="question-16" class="question-container">
            <div class="question">
                <p>16.) Le gène des eucaryotes est constitué de régions codantes : les exons séparés en général par des séquences non codantes : les introns. Parmi les cinq propositions choisissez les bonnes réponses ?</p>
                <ul>
        
                    <li><input type="checkbox" id="q16a" name="q16" value="A"> A- En amont du gène, se trouve une séquence régulatrice et le promoteur</li>
            
                    <li><input type="checkbox" id="q16b" name="q16" value="B"> B- En aval du gène, se trouve une séquence régulatrice et le promoteur</li>
            
                    <li><input type="checkbox" id="q16c" name="q16" value="C"> C- L'intron est un fragment du gène situé entre deux exons</li>
            
                    <li><input type="checkbox" id="q16d" name="q16" value="D"> D- Les introns sont éliminés au cours de la maturation de l'ARNm</li>
            
                    <li><input type="checkbox" id="q16e" name="q16" value="E"> E- Certains introns jouent un rôle important dans la régulation de l'expression d'un gène</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q16')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q16')">Réessayer</button>
                <button class="favorite-button" data-question="16">&#10084;</button>
            </div>
        </div>
        
        <div id="question-17" class="question-container">
            <div class="question">
                <p>17.) Le code génétique est la loi de correspondance entre la séquence en nucléotides de l'ADN ou de l'ARN, et la séquence en AA du polypeptide correspondant.Le codon ATG :</p>
                <ul>
        
                    <li><input type="checkbox" id="q17a" name="q17" value="A"> A- À partir duquel commence la traduction (signal d'initiation de la traduction)</li>
            
                    <li><input type="checkbox" id="q17b" name="q17" value="B"> B- Code aussi pour un acide aminé, la méthionine (appelée encore méthionine initiatrice)</li>
            
                    <li><input type="checkbox" id="q17c" name="q17" value="C"> C- Est un des codons de terminaison de la traduction</li>
            
                    <li><input type="checkbox" id="q17d" name="q17" value="D"> D- Est sans signification ni intérêt au cours de la traduction</li>
            
                    <li><input type="checkbox" id="q17e" name="q17" value="E"> E- Site d'initiation de la transcription</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q17')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q17')">Réessayer</button>
                <button class="favorite-button" data-question="17">&#10084;</button>
            </div>
        </div>
        
        <div id="question-18" class="question-container">
            <div class="question">
                <p>18.) La synthèse de protéine au niveau du cytoplasme :</p>
                <ul>
        
                    <li><input type="checkbox" id="q18a" name="q18" value="A"> A- Est réalisée par un ribosome à partir de l'ARNm et d'acides aminés présents</li>
            
                    <li><input type="checkbox" id="q18b" name="q18" value="B"> B- Produit des protéines qui sont formées d'une succession de nucléotides</li>
            
                    <li><input type="checkbox" id="q18c" name="q18" value="C"> C- Elle s'arrête lorsqu'il n'y a plus de nucléotides</li>
            
                    <li><input type="checkbox" id="q18d" name="q18" value="D"> D- Est réalisée par plusieurs exemplaires de protéines identiques à partir d'un même gène</li>
            
                    <li><input type="checkbox" id="q18e" name="q18" value="E"> E- Est réalisée par des ribosomes constitués de deux sous-unités qui contiennent 3 sites appelés A, P et E</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q18')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q18')">Réessayer</button>
                <button class="favorite-button" data-question="18">&#10084;</button>
            </div>
        </div>
        
            <div class="button-container">
                <button type="button" class="submit-quiz-button" onclick="submitQuiz()">Soumettre tout le Quiz</button>
                <button id="voir-favoris-btn" class="favorite-button" onclick="voirFavoris2016R()">Voir Favoris</button>
            </div>

            <div class="blur-background" id="blur-background"></div>

            <div class="result-popup" id="result-popup">
                <h3>Résultat du Quiz</h3>
                <div id="result"></div>
                <button id="close-result" class="close-button" onclick="closeResult(event)">Fermer</button>
                <button id="voir-detail-btn" class="detail-button" style="display: none;" onclick="afficherDetails(event)">Voir Détail</button>
                <button type="button" class="reset-quiz-button" onclick="resetAll()">Réessayer tout le Quiz</button>
            </div>

            <div id="details-section" class="details-section" style="display: none;">
                <h3>Tableau des questions</h3>
                <div class="question-links" id="question-links"></div>
            </div>

            <div id="timer-container">
                <span id="timer">60:00</span>
            </div>

            <div id="details-section" style="display:none;">
                <h2>Questions :</h2>
                <div id="question-links" class="question-links"></div>
            </div>

            <script>
                // Scripts pour la gestion du quiz
            </script>
        </form>
        </div>
    </body>
    </html>
// Fonction pour corriger une question
function correctQuestion(questionName) {
    const form = document.getElementById('quiz-form');
    const questionDiv = document.querySelector(`input[name="${questionName}"]`).closest('.question-container');
    const selected = Array.from(form.elements[questionName]).filter(input => input.checked).map(input => input.value);

    // Calculer si la réponse est correcte
    const isCorrect = JSON.stringify(correctAnswers[questionName].sort()) === JSON.stringify(selected.sort());

    // Enregistre si la réponse est correcte ou incorrecte
    userAnswers[questionName] = {
        selected: selected,
        isCorrect: isCorrect
    };

    // Supprimer les styles précédents
    questionDiv.classList.remove('correct', 'incorrect');
    questionDiv.querySelectorAll('li').forEach(li => li.style.color = '');

    // Applique les couleurs selon la validité des réponses
    questionDiv.querySelectorAll('li').forEach(li => {
        const isChoiceCorrect = correctAnswers[questionName].includes(li.querySelector('input').value);
        const isSelected = selected.includes(li.querySelector('input').value);

        if (isChoiceCorrect) {
            // Appliquer le style vert aux bonnes réponses
            li.style.color = 'green';
            li.style.fontWeight = 'bold';
            li.style.textShadow = '1px 1px 2px rgba(0, 128, 0, 0.7)';
        }

        if (isSelected && !isChoiceCorrect) {
            // Appliquer le style rouge pour les mauvaises réponses sélectionnées
            li.style.color = 'red';
        }
    });

    console.log(`Début de la correction pour la question ${questionName}`);
    console.log(`Réponses sélectionnées pour ${questionName}: ${selected.join(', ')}`);
    console.log(`Résultat pour ${questionName}: ${isCorrect ? 'Correct' : 'Incorrect'}`);

    // Déterminer le nom de l'examen et l'ID complet de la question
    const examNameElement = document.getElementById('exam_name');
    const examName = examNameElement.value; // Nom de l'examen (par exemple, Anatomie2023)
    const fullChoiceIds = selected.map(choice => `${examName}_${questionName.substring(1)}_${choice.toLowerCase()}`);
    console.log(`IDs complets générés pour les choix : ${fullChoiceIds.join(', ')}`);

    // Envoyer les données au serveur
    fetch('/track_attempts/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({
            question_name: questionName,
            full_choice_ids: fullChoiceIds
        })
    })
        .then(response => response.json())
        .then(data => {
            console.log(`Données reçues du serveur : ${JSON.stringify(data)}`);
            handleAlert(data.alert, questionDiv);
            updateStatisticalAlerts(data, questionDiv);
        })
        .catch(error => console.error('Erreur lors de l’envoi des données:', error));
}

// Fonction pour gérer les alertes
function handleAlert(alertData, questionDiv) {
    const existingAlert = questionDiv.querySelector('.alert-indicator');
    if (existingAlert) {
        existingAlert.remove();
    }

    if (alertData) {
        const alertIndicator = document.createElement('div');
        alertIndicator.className = 'alert-indicator';
        alertIndicator.style.backgroundColor = alertData.color || '#f8d7da';
        alertIndicator.style.padding = '10px';
        alertIndicator.style.marginTop = '10px';
        alertIndicator.style.borderRadius = '5px';
        alertIndicator.style.fontWeight = 'bold';
        alertIndicator.style.color = '#721c24';
        alertIndicator.style.boxShadow = '0 2px 5px rgba(0, 0, 0, 0.1)';
        alertIndicator.textContent = alertData.message;

        questionDiv.appendChild(alertIndicator);
        saveAlertToLocalStorage(questionDiv.getAttribute('data-question-id'), alertData);
    } else {
        removeAlertFromLocalStorage(questionDiv.getAttribute('data-question-id'));
    }
}

// Charger les alertes persistantes
function loadAlertsFromLocalStorage() {
    const storedAlerts = JSON.parse(localStorage.getItem('alerts')) || {};
    Object.keys(storedAlerts).forEach(questionId => {
        const questionDiv = document.querySelector(`.question-container[data-question-id="${questionId}"]`);
        if (questionDiv) {
            handleAlert(storedAlerts[questionId], questionDiv);
        }
    });
}

// Sauvegarder les alertes dans localStorage
function saveAlertToLocalStorage(questionId, alertData) {
    const storedAlerts = JSON.parse(localStorage.getItem('alerts')) || {};
    storedAlerts[questionId] = alertData;
    localStorage.setItem('alerts', JSON.stringify(storedAlerts));
}

// Supprimer une alerte de localStorage
function removeAlertFromLocalStorage(questionId) {
    const storedAlerts = JSON.parse(localStorage.getItem('alerts')) || {};
    delete storedAlerts[questionId];
    localStorage.setItem('alerts', JSON.stringify(storedAlerts));
}

// Mise à jour des alertes statistiques
function updateStatisticalAlerts(data, questionDiv) {
    const existingStatisticalAlerts = questionDiv.querySelectorAll('.statistical-alert');
    existingStatisticalAlerts.forEach(alert => alert.remove());

    if (data.failure_rate > 0.6) {
        const failureRateAlert = document.createElement('div');
        failureRateAlert.className = 'statistical-alert';
        failureRateAlert.style.backgroundColor = '#add8e6';
        failureRateAlert.style.padding = '10px';
        failureRateAlert.style.marginTop = '10px';
        failureRateAlert.style.borderRadius = '5px';
        failureRateAlert.style.fontWeight = 'bold';
        failureRateAlert.style.color = '#004085';
        failureRateAlert.style.boxShadow = '0 2px 5px rgba(0, 0, 0, 0.1)';
        failureRateAlert.textContent = `🔵 Votre taux d'échec est de ${(data.failure_rate * 100).toFixed(0)}%. Revoir cette question est conseillé.`;

        questionDiv.appendChild(failureRateAlert);
    }
}

// Charger les alertes au démarrage
document.addEventListener('DOMContentLoaded', () => {
    loadAlertsFromLocalStorage();
});

</script>
