
    <!DOCTYPE html>
    <html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Quiz Luck</title>
        <link rel="stylesheet" href="stylequiz.css">
    </head>
    <body>
        <div class="container">
            <div class="quiz-title">
                <h1>QCM Anatomie 1</h1>
            </div>
            <form id="quiz-form">
    <input type="hidden" id='exam_name' name="exam_name" value="Gen2016B">
    {% csrf_token %}>
    
        <div id="question-1" class="question-container">
            <div class="question">
                <p>1.) L'acide désoxyribonucléique (ADN) :</p>
                <ul>
        
                    <li><input type="checkbox" id="q1a" name="q1" value="A"> A- Les liaisons hydrogène sont au nombre de trois entre le A et le T et au nombre de deux entre le C et le G</li>
            
                    <li><input type="checkbox" id="q1b" name="q1" value="B"> B- Chez les eucaryotes, la quasi-totalité de l'ADN se trouve dans le noyau et une petite quantité (1% environ) est retrouvée dans les mitochondries</li>
            
                    <li><input type="checkbox" id="q1c" name="q1" value="C"> C- L'appariement entre les bases est spécifique, seuls deux combinaisons sont possibles : le A avec le G et le C avec le T</li>
            
                    <li><input type="checkbox" id="q1d" name="q1" value="D"> D- Les deux brins d'ADN sont associés par des liaisons faibles (liaisons hydrogène)</li>
            
                    <li><input type="checkbox" id="q1e" name="q1" value="E"> E- La réassociation des deux brins d'ADN est appelée hybridation.</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q1')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q1')">Réessayer</button>
                <button class="favorite-button" data-question="1">&#10084;</button>
            </div>
        </div>
        
        <div id="question-2" class="question-container">
            <div class="question">
                <p>2.) Les microARN (microRNA, miRNA) :</p>
                <ul>
        
                    <li><input type="checkbox" id="q2a" name="q2" value="A"> A- Impliqués dans l'épissage du pré-ARNm et la maturation de l'ARNr</li>
            
                    <li><input type="checkbox" id="q2b" name="q2" value="B"> B- ARN non codant d'environ 22 pb et interviennent dans la régulation post-transcriptionnelle et de la traduction</li>
            
                    <li><input type="checkbox" id="q2c" name="q2" value="C"> C- Impliqués dans les modifications et la maturation des ARNr</li>
            
                    <li><input type="checkbox" id="q2d" name="q2" value="D"> D- ARN issus d'ARN double brin et jouant un rôle dans la dégradation d'ARN dont ils sont complémentaires</li>
            
                    <li><input type="checkbox" id="q2e" name="q2" value="E"> E- ARN aux capacités d'auto-épissage présents dans les ARN 28S</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q2')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q2')">Réessayer</button>
                <button class="favorite-button" data-question="2">&#10084;</button>
            </div>
        </div>
        
        <div id="question-3" class="question-container">
            <div class="question">
                <p>3.) L'ARN messager (ARNm) :</p>
                <ul>
        
                    <li><input type="checkbox" id="q3a" name="q3" value="A"> A- Provient de la transcription de l'ADN</li>
            
                    <li><input type="checkbox" id="q3b" name="q3" value="B"> B- Ne sert pas de matrice pour la traduction en protéine</li>
            
                    <li><input type="checkbox" id="q3c" name="q3" value="C"> C- Après synthèse du pré-ARNm par transcription de l'ADN génomique, les introns sont éliminés par épissage</li>
            
                    <li><input type="checkbox" id="q3d" name="q3" value="D"> D- Sont les seuls ARN codants</li>
            
                    <li><input type="checkbox" id="q3e" name="q3" value="E"> E- Est impliqué dans les modifications et la maturation des ARNr</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q3')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q3')">Réessayer</button>
                <button class="favorite-button" data-question="3">&#10084;</button>
            </div>
        </div>
        
        <div id="question-4" class="question-container">
            <div class="question">
                <p>4.) A propos du code génétique, parmi les cinq propositions choisissez les bonnes réponses :</p>
                <ul>
        
                    <li><input type="checkbox" id="q4a" name="q4" value="A"> A- Le nombre de codons possibles (41 soit 69) étant plus important que le nombre d'acides aminés existant</li>
            
                    <li><input type="checkbox" id="q4b" name="q4" value="B"> B- Deux acides aminés seulement possèdent un seul codon, la méthionine et le tryptophane</li>
            
                    <li><input type="checkbox" id="q4c" name="q4" value="C"> C- Trois codons (TAA, TAG, TGA), signaux de fin de traduction</li>
            
                    <li><input type="checkbox" id="q4d" name="q4" value="D"> D- Le code génétique n'est pas universel</li>
            
                    <li><input type="checkbox" id="q4e" name="q4" value="E"> E- Un codon initiateur ACG est le codon à partir duquel commence la traduction</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q4')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q4')">Réessayer</button>
                <button class="favorite-button" data-question="4">&#10084;</button>
            </div>
        </div>
        
        <div id="question-5" class="question-container">
            <div class="question">
                <p>5.) Parmi les cinq propositions choisissez les bonnes réponses :</p>
                <ul>
        
                    <li><input type="checkbox" id="q5a" name="q5" value="A"> A- Gène</li>
            
                    <li><input type="checkbox" id="q5b" name="q5" value="B"> B- Promoteur</li>
            
                    <li><input type="checkbox" id="q5c" name="q5" value="C"> C- Régions flanquantes 5’’</li>
            
                    <li><input type="checkbox" id="q5d" name="q5" value="D"> D- Intron</li>
            
                    <li><input type="checkbox" id="q5e" name="q5" value="E"> E- Zones de contrôle</li>
            
                    <li><input type="checkbox" id="q5f" name="q5" value="F"> F- Début de la transcription</li>
            
                    <li><input type="checkbox" id="q5g" name="q5" value="G"> G- Exons</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q5')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q5')">Réessayer</button>
                <button class="favorite-button" data-question="5">&#10084;</button>
            </div>
        </div>
        
        <div id="question-6" class="question-container">
            <div class="question">
                <p>6.) Parmi les cinq propositions choisissez les bonnes réponses :</p>
                <ul>
        
                    <li><input type="checkbox" id="q6a" name="q6" value="A"> A- Les fragments d’Okasaki sont des morceaux de DNA synthétisés sur le brin orienté 5’—> 3’</li>
            
                    <li><input type="checkbox" id="q6b" name="q6" value="B"> B- L’ARN est synthétisé à partir de l’ADN au cours de la traduction</li>
            
                    <li><input type="checkbox" id="q6c" name="q6" value="C"> C- La réplication du DNA ne peut se faire qu’à partir d’une amorce d’ARN qui sera éliminée ultérieurement</li>
            
                    <li><input type="checkbox" id="q6d" name="q6" value="D"> D- Le capping en 5’ est la première étape de la maturation, elle consiste en la fixation d’un « chapeau » ou un « cap » à l’extrémité 5’ de l’ARNm</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q6')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q6')">Réessayer</button>
                <button class="favorite-button" data-question="6">&#10084;</button>
            </div>
        </div>
        
        <div id="question-7" class="question-container">
            <div class="question">
                <p>7.) A propos de la réplication de l'ADN, indiquez les propositions exactes.</p>
                <ul>
        
                    <li><input type="checkbox" id="q7a" name="q7" value="A"> A- L’enzyme clé de la réplication est l’ARN polymérase</li>
            
                    <li><input type="checkbox" id="q7b" name="q7" value="B"> B- La réplication est bi-directionnelle</li>
            
                    <li><input type="checkbox" id="q7c" name="q7" value="C"> C- La réplication est semi-discontinue</li>
            
                    <li><input type="checkbox" id="q7d" name="q7" value="D"> D- La réplication est mono-directionnelle</li>
            
                    <li><input type="checkbox" id="q7e" name="q7" value="E"> E- L’ADN polymérase ne nécessite pas d’amorce</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q7')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q7')">Réessayer</button>
                <button class="favorite-button" data-question="7">&#10084;</button>
            </div>
        </div>
        
        <div id="question-8" class="question-container">
            <div class="question">
                <p>8.) A propos des caractéristiques de l’ADN mitochondrial, indiquez les propositions exactes.</p>
                <ul>
        
                    <li><input type="checkbox" id="q8a" name="q8" value="A"> A- C’est un ADN nu, double brin, circulaire et non lié aux protéines</li>
            
                    <li><input type="checkbox" id="q8b" name="q8" value="B"> B- L’ADN mitochondrial est transmis de manière générale par le père</li>
            
                    <li><input type="checkbox" id="q8c" name="q8" value="C"> C- Chaque mitochondrie contient deux à dix molécules d’ADN et chaque cellule contient de très nombreuses mitochondries (jusqu’à plusieurs milliers)</li>
            
                    <li><input type="checkbox" id="q8d" name="q8" value="D"> D- Dans une même mitochondrie, peuvent coexister de l’ADN normal et de l’ADN muté. On parle alors d’hétéroplasmie</li>
            
                    <li><input type="checkbox" id="q8e" name="q8" value="E"> E- En cas de présence uniquement d’ADN normal ou uniquement d’ADN muté, on parle d’homoplasmie</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q8')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q8')">Réessayer</button>
                <button class="favorite-button" data-question="8">&#10084;</button>
            </div>
        </div>
        
        <div id="question-9" class="question-container">
            <div class="question">
                <p>9.) Parmi les cinq propositions choisissez les bonnes réponses ?</p>
                <ul>
        
                    <li><input type="checkbox" id="q9a" name="q9" value="A"> A- La boite ATA « ATA box » est une séquence de 5 à 7 bases situées à 300 bases en amont du site d'initiation de la transcription.</li>
            
                    <li><input type="checkbox" id="q9b" name="q9" value="B"> B- La boite « CAAT » plus en amont, à -70 bases en amont du site d'initiation de la transcription.</li>
            
                    <li><input type="checkbox" id="q9c" name="q9" value="C"> C- Le codon CTC site d'initiation de la transcription.</li>
            
                    <li><input type="checkbox" id="q9d" name="q9" value="D"> D- Le codon AUG Codon d'initiation de la transcription.</li>
            
                    <li><input type="checkbox" id="q9e" name="q9" value="E"> E- Les codons UAG, UGA et UAA sont des codons de terminaison de la traduction.</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q9')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q9')">Réessayer</button>
                <button class="favorite-button" data-question="9">&#10084;</button>
            </div>
        </div>
        
        <div id="question-10" class="question-container">
            <div class="question">
                <p>10.) Les topo-isomérases (enzymes de la réplication) :</p>
                <ul>
        
                    <li><input type="checkbox" id="q10a" name="q10" value="A"> A- Déroulent et séparent les deux brins d'ADN, ceci conduit à une structure en Y appelée fourche de réplication.</li>
            
                    <li><input type="checkbox" id="q10b" name="q10" value="B"> B- Effectuent la soudure du brin d'ADN entre deux fragments adjacents.</li>
            
                    <li><input type="checkbox" id="q10c" name="q10" value="C"> C- Maintiennent séparés les deux brins d'ADN.</li>
            
                    <li><input type="checkbox" id="q10d" name="q10" value="D"> D- Permettent le passage de l'ADN d'un état super enroulé, provoqué par la progression de la fourche de réplication, à des formes isomères de moindre tension.</li>
            
                    <li><input type="checkbox" id="q10e" name="q10" value="E"> E- Synthétisent le primase ou amorce et font partie d'un complexe protéique appelé primosome.</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q10')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q10')">Réessayer</button>
                <button class="favorite-button" data-question="10">&#10084;</button>
            </div>
        </div>
        
        <div id="question-11" class="question-container">
            <div class="question">
                <p>11.) Le caryotype métaphasique :</p>
                <ul>
        
                    <li><input type="checkbox" id="q11a" name="q11" value="A"> A- C'est l'ensemble des chromosomes classés d'un individu.</li>
            
                    <li><input type="checkbox" id="q11b" name="q11" value="B"> B- Les fibroblastes sont les cellules les plus utilisées en pratique médicale pour obtenir un caryotype métaphasique.</li>
            
                    <li><input type="checkbox" id="q11c" name="q11" value="C"> C- Le stock chromosomique est caractéristique de l'espèce, il est composé d'un ensemble de chromosomes : le haploïde N. Chez l'Homme, le nombre Haploïde étant N = 23.</li>
            
                    <li><input type="checkbox" id="q11d" name="q11" value="D"> D- Les lymphocytes sanguins sont les cellules les plus utilisées en pratique médicale pour obtenir un caryotype métaphasique.</li>
            
                    <li><input type="checkbox" id="q11e" name="q11" value="E"> E- Les chromosomes humains sont classés en fonction de leur taille et de la position du centromère d'où l'idée centromérique (p-q).</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q11')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q11')">Réessayer</button>
                <button class="favorite-button" data-question="11">&#10084;</button>
            </div>
        </div>
        
        <div id="question-12" class="question-container">
            <div class="question">
                <p>12.) Parmi les cinq propositions choisissez les bonnes réponses ?</p>
                <ul>
        
                    <li><input type="checkbox" id="q12a" name="q12" value="A"> A- Trois trisomies autosomiques sont viables à l'état homogène dans l'espèce humaine : trisomie 21 (Syndrome de Down), trisomie 13 (Syndrome de Patau), trisomie 18 (Syndrome d'Edwards).</li>
            
                    <li><input type="checkbox" id="q12b" name="q12" value="B"> B- Le syndrome de Klinefelter correspond à un individu possédant un chromosome Y en double exemplaire, et un chromosome X (XYY).</li>
            
                    <li><input type="checkbox" id="q12c" name="q12" value="C"> C- Le syndrome de Turner à «45,X» est la seule monosomie homogène viable dans l'espèce humaine.</li>
            
                    <li><input type="checkbox" id="q12d" name="q12" value="D"> D- Les translocations robertsoniennes (rob) correspondent à des échanges de segments chromosomiques entre deux chromosomes.</li>
            
                    <li><input type="checkbox" id="q12e" name="q12" value="E"> E- Aucune monosomie autosomique constitutionnelle n'est viable.</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q12')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q12')">Réessayer</button>
                <button class="favorite-button" data-question="12">&#10084;</button>
            </div>
        </div>
        
        <div id="question-13" class="question-container">
            <div class="question">
                <p>13.) Les translocations robertsoniennes (rob) :</p>
                <ul>
        
                    <li><input type="checkbox" id="q13a" name="q13" value="A"> A- Sont dues à des fusions centromériques entre 2 chromosomes acrocentriques.</li>
            
                    <li><input type="checkbox" id="q13b" name="q13" value="B"> B- Se produisent entre chromosomes acrocentriques (13, 14, 15, 21 et 22).</li>
            
                    <li><input type="checkbox" id="q13c" name="q13" value="C"> C- Sont dues à deux cassures sur le même chromosome, suivies de recollement après inversion du segment intermédiaire.</li>
            
                    <li><input type="checkbox" id="q13d" name="q13" value="D"> D- Les translocations robertsoniennes sont responsables de la majorité des formes familiales des trisomies 21.</li>
            
                    <li><input type="checkbox" id="q13e" name="q13" value="E"> E- Les translocations sont dues à des échanges de segments chromosomiques entre deux chromosomes.</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q13')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q13')">Réessayer</button>
                <button class="favorite-button" data-question="13">&#10084;</button>
            </div>
        </div>
        
        <div id="question-14" class="question-container">
            <div class="question">
                <p>14.) Parmi les cinq propositions choisissez les bonnes réponses ?</p>
                <ul>
        
                    <li><input type="checkbox" id="q14a" name="q14" value="A"> A- Les remaniements constitutionnels sont présents dès la conception ou se forment lors des premières divisions du zygote.</li>
            
                    <li><input type="checkbox" id="q14b" name="q14" value="B"> B- Les anomalies de nombre résultent d'une mauvaise répartition des chromosomes lors d'une division cellulaire ou d'une anomalie de la fécondation.</li>
            
                    <li><input type="checkbox" id="q14c" name="q14" value="C"> C- Les anomalies de structure impliquent une ou plusieurs cassures chromosomiques suivies d'un recollement anormal.</li>
            
                    <li><input type="checkbox" id="q14d" name="q14" value="D"> D- 10% des naissances sont porteuses d'anomalies chromosomiques.</li>
            
                    <li><input type="checkbox" id="q14e" name="q14" value="E"> E- 50% des conceptions finissent par un avortement spontané dont la moitié est due à des anomalies chromosomiques.</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q14')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q14')">Réessayer</button>
                <button class="favorite-button" data-question="14">&#10084;</button>
            </div>
        </div>
        
        <div id="question-15" class="question-container">
            <div class="question">
                <p>15.) Les mutations faux sens :</p>
                <ul>
        
                    <li><input type="checkbox" id="q15a" name="q15" value="A"> A- Sont des mutations aboutissant à des codons stop UAA UAG UGA sur l'ARNm.</li>
            
                    <li><input type="checkbox" id="q15b" name="q15" value="B"> B- Sont des mutations qui modifient la signification d'un codon. Il en résulte un changement d'un AA sur la protéine correspondante. La conséquence de cette mutation est variable selon la nature du changement et son emplacement.</li>
            
                    <li><input type="checkbox" id="q15c" name="q15" value="C"> C- Sont des mutations qui créent ou suppriment un site d'épissage et sont responsables d'un décalage du cadre de lecture.</li>
            
                    <li><input type="checkbox" id="q15d" name="q15" value="D"> D- Sont des mutations qui agissent par délétion ou insertion d'une base, de deux bases ou d'un non multiple de 3 bases et conduisent à une protéine incomplète qui est presque toujours rapidement dégradée.</li>
            
                    <li><input type="checkbox" id="q15e" name="q15" value="E"> E- Sont des mutations qui portent sur la séquence correspondant à l'un des trois codons stop qui devient signifiant, entraînant ainsi une prolongation de la traduction jusqu'au codon stop suivant. Il en résulte une élongation de la chaîne polypeptidique.</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q15')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q15')">Réessayer</button>
                <button class="favorite-button" data-question="15">&#10084;</button>
            </div>
        </div>
        
            <div class="button-container">
                <button type="button" class="submit-quiz-button" onclick="submitQuiz()">Soumettre tout le Quiz</button>
                <button id="voir-favoris-btn" class="favorite-button" onclick="voirFavoris2016R()">Voir Favoris</button>
            </div>

            <div class="blur-background" id="blur-background"></div>

            <div class="result-popup" id="result-popup">
                <h3>Résultat du Quiz</h3>
                <div id="result"></div>
                <button id="close-result" class="close-button" onclick="closeResult(event)">Fermer</button>
                <button id="voir-detail-btn" class="detail-button" style="display: none;" onclick="afficherDetails(event)">Voir Détail</button>
                <button type="button" class="reset-quiz-button" onclick="resetAll()">Réessayer tout le Quiz</button>
            </div>

            <div id="details-section" class="details-section" style="display: none;">
                <h3>Tableau des questions</h3>
                <div class="question-links" id="question-links"></div>
            </div>

            <div id="timer-container">
                <span id="timer">60:00</span>
            </div>

            <div id="details-section" style="display:none;">
                <h2>Questions :</h2>
                <div id="question-links" class="question-links"></div>
            </div>

            <script>
                // Scripts pour la gestion du quiz
            </script>
        </form>
        </div>
    </body>
    </html>
// Fonction pour corriger une question
function correctQuestion(questionName) {
    const form = document.getElementById('quiz-form');
    const questionDiv = document.querySelector(`input[name="${questionName}"]`).closest('.question-container');
    const selected = Array.from(form.elements[questionName]).filter(input => input.checked).map(input => input.value);

    // Calculer si la réponse est correcte
    const isCorrect = JSON.stringify(correctAnswers[questionName].sort()) === JSON.stringify(selected.sort());

    // Enregistre si la réponse est correcte ou incorrecte
    userAnswers[questionName] = {
        selected: selected,
        isCorrect: isCorrect
    };

    // Supprimer les styles précédents
    questionDiv.classList.remove('correct', 'incorrect');
    questionDiv.querySelectorAll('li').forEach(li => li.style.color = '');

    // Applique les couleurs selon la validité des réponses
    questionDiv.querySelectorAll('li').forEach(li => {
        const isChoiceCorrect = correctAnswers[questionName].includes(li.querySelector('input').value);
        const isSelected = selected.includes(li.querySelector('input').value);

        if (isChoiceCorrect) {
            // Appliquer le style vert aux bonnes réponses
            li.style.color = 'green';
            li.style.fontWeight = 'bold';
            li.style.textShadow = '1px 1px 2px rgba(0, 128, 0, 0.7)';
        }

        if (isSelected && !isChoiceCorrect) {
            // Appliquer le style rouge pour les mauvaises réponses sélectionnées
            li.style.color = 'red';
        }
    });

    console.log(`Début de la correction pour la question ${questionName}`);
    console.log(`Réponses sélectionnées pour ${questionName}: ${selected.join(', ')}`);
    console.log(`Résultat pour ${questionName}: ${isCorrect ? 'Correct' : 'Incorrect'}`);

    // Déterminer le nom de l'examen et l'ID complet de la question
    const examNameElement = document.getElementById('exam_name');
    const examName = examNameElement.value; // Nom de l'examen (par exemple, Anatomie2023)
    const fullChoiceIds = selected.map(choice => `${examName}_${questionName.substring(1)}_${choice.toLowerCase()}`);
    console.log(`IDs complets générés pour les choix : ${fullChoiceIds.join(', ')}`);

    // Envoyer les données au serveur
    fetch('/track_attempts/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({
            question_name: questionName,
            full_choice_ids: fullChoiceIds
        })
    })
        .then(response => response.json())
        .then(data => {
            console.log(`Données reçues du serveur : ${JSON.stringify(data)}`);
            handleAlert(data.alert, questionDiv);
            updateStatisticalAlerts(data, questionDiv);
        })
        .catch(error => console.error('Erreur lors de l’envoi des données:', error));
}

// Fonction pour gérer les alertes
function handleAlert(alertData, questionDiv) {
    const existingAlert = questionDiv.querySelector('.alert-indicator');
    if (existingAlert) {
        existingAlert.remove();
    }

    if (alertData) {
        const alertIndicator = document.createElement('div');
        alertIndicator.className = 'alert-indicator';
        alertIndicator.style.backgroundColor = alertData.color || '#f8d7da';
        alertIndicator.style.padding = '10px';
        alertIndicator.style.marginTop = '10px';
        alertIndicator.style.borderRadius = '5px';
        alertIndicator.style.fontWeight = 'bold';
        alertIndicator.style.color = '#721c24';
        alertIndicator.style.boxShadow = '0 2px 5px rgba(0, 0, 0, 0.1)';
        alertIndicator.textContent = alertData.message;

        questionDiv.appendChild(alertIndicator);
        saveAlertToLocalStorage(questionDiv.getAttribute('data-question-id'), alertData);
    } else {
        removeAlertFromLocalStorage(questionDiv.getAttribute('data-question-id'));
    }
}

// Charger les alertes persistantes
function loadAlertsFromLocalStorage() {
    const storedAlerts = JSON.parse(localStorage.getItem('alerts')) || {};
    Object.keys(storedAlerts).forEach(questionId => {
        const questionDiv = document.querySelector(`.question-container[data-question-id="${questionId}"]`);
        if (questionDiv) {
            handleAlert(storedAlerts[questionId], questionDiv);
        }
    });
}

// Sauvegarder les alertes dans localStorage
function saveAlertToLocalStorage(questionId, alertData) {
    const storedAlerts = JSON.parse(localStorage.getItem('alerts')) || {};
    storedAlerts[questionId] = alertData;
    localStorage.setItem('alerts', JSON.stringify(storedAlerts));
}

// Supprimer une alerte de localStorage
function removeAlertFromLocalStorage(questionId) {
    const storedAlerts = JSON.parse(localStorage.getItem('alerts')) || {};
    delete storedAlerts[questionId];
    localStorage.setItem('alerts', JSON.stringify(storedAlerts));
}

// Mise à jour des alertes statistiques
function updateStatisticalAlerts(data, questionDiv) {
    const existingStatisticalAlerts = questionDiv.querySelectorAll('.statistical-alert');
    existingStatisticalAlerts.forEach(alert => alert.remove());

    if (data.failure_rate > 0.6) {
        const failureRateAlert = document.createElement('div');
        failureRateAlert.className = 'statistical-alert';
        failureRateAlert.style.backgroundColor = '#add8e6';
        failureRateAlert.style.padding = '10px';
        failureRateAlert.style.marginTop = '10px';
        failureRateAlert.style.borderRadius = '5px';
        failureRateAlert.style.fontWeight = 'bold';
        failureRateAlert.style.color = '#004085';
        failureRateAlert.style.boxShadow = '0 2px 5px rgba(0, 0, 0, 0.1)';
        failureRateAlert.textContent = `🔵 Votre taux d'échec est de ${(data.failure_rate * 100).toFixed(0)}%. Revoir cette question est conseillé.`;

        questionDiv.appendChild(failureRateAlert);
    }
}

// Charger les alertes au démarrage
document.addEventListener('DOMContentLoaded', () => {
    loadAlertsFromLocalStorage();
});

</script>
