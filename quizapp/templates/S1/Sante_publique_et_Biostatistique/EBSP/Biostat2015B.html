
    <!DOCTYPE html>
    <html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Quiz Luck</title>
        <link rel="stylesheet" href="stylequiz.css">
    </head>
    <body>
        <div class="container">
            <div class="quiz-title">
                <h1>QCM Anatomie 1</h1>
            </div>
            <form id="quiz-form">
    <input type="hidden" id='exam_name' name="exam_name" value="Biostat2015B">
    {% csrf_token %}>
    
        <div id="question-1" class="question-container">
            <div class="question">
                <p>1.) Un échantillon est :</p>
                <ul>
        
                    <li><input type="checkbox" id="q1a" name="q1" value="A"> A- Un sous-groupe forcément représentatif de la population</li>
            
                    <li><input type="checkbox" id="q1b" name="q1" value="B"> B- Un sous-groupe qui doit avoir une taille > 30 pour être représentatif</li>
            
                    <li><input type="checkbox" id="q1c" name="q1" value="C"> C- Un sous-groupe tiré toujours d'une manière aléatoire</li>
            
                    <li><input type="checkbox" id="q1d" name="q1" value="D"> D- Un sous-groupe stratifié sur la variable d'intérêt</li>
            
                    <li><input type="checkbox" id="q1e" name="q1" value="E"> E- Un sous-groupe de la population</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q1')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q1')">Réessayer</button>
                <button class="favorite-button" data-question="1">&#10084;</button>
            </div>
        </div>
        
        <div id="question-2" class="question-container">
            <div class="question">
                <p>2.) La variable « groupe sanguin ABO » est une :</p>
                <ul>
        
                    <li><input type="checkbox" id="q2a" name="q2" value="A"> A- variable quantitative continue</li>
            
                    <li><input type="checkbox" id="q2b" name="q2" value="B"> B- variable quantitative discrète</li>
            
                    <li><input type="checkbox" id="q2c" name="q2" value="C"> C- variable qualitative ordinale</li>
            
                    <li><input type="checkbox" id="q2d" name="q2" value="D"> D- variable qualitative nominale</li>
            
                    <li><input type="checkbox" id="q2e" name="q2" value="E"> E- variable qualitative dichotomique (ou binaire)</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q2')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q2')">Réessayer</button>
                <button class="favorite-button" data-question="2">&#10084;</button>
            </div>
        </div>
        
        <div id="question-3" class="question-container">
            <div class="question">
                <p>3.) Choisissez la bonne proposition :</p>
                <ul>
        
                    <li><input type="checkbox" id="q3a" name="q3" value="A"> A- La moyenne est toujours égale à 0 dans le cas d'une loi normale centrée réduite</li>
            
                    <li><input type="checkbox" id="q3b" name="q3" value="B"> B- La formule de la moyenne pour un échantillon de N sujets est la somme des carrés de (x_i allant à x_n) divisée par N</li>
            
                    <li><input type="checkbox" id="q3c" name="q3" value="C"> C- La moyenne peut être calculée pour une variable qualitative nominale</li>
            
                    <li><input type="checkbox" id="q3d" name="q3" value="D"> D- La moyenne est égale à l'écart-type moins 1,96 dans le cas d'une loi normale</li>
            
                    <li><input type="checkbox" id="q3e" name="q3" value="E"> E- Pour calculer la moyenne, il faut ranger les valeurs de la plus petite à la plus grande</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q3')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q3')">Réessayer</button>
                <button class="favorite-button" data-question="3">&#10084;</button>
            </div>
        </div>
        
        <div id="question-4" class="question-container">
            <div class="question">
                <p>4.) L'écart type :</p>
                <ul>
        
                    <li><input type="checkbox" id="q4a" name="q4" value="A"> A- est la racine carrée de la déviation standard</li>
            
                    <li><input type="checkbox" id="q4b" name="q4" value="B"> B- lorsqu'il est bas, il correspond à des données proches de la valeur centrale</li>
            
                    <li><input type="checkbox" id="q4c" name="q4" value="C"> C- est égal à la moyenne plus 2 fois l'écart type</li>
            
                    <li><input type="checkbox" id="q4d" name="q4" value="D"> D- s'exprime toujours en carré des valeurs de x</li>
            
                    <li><input type="checkbox" id="q4e" name="q4" value="E"> E- Ne peut être supérieur à 0</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q4')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q4')">Réessayer</button>
                <button class="favorite-button" data-question="4">&#10084;</button>
            </div>
        </div>
        
        <div id="question-5" class="question-container">
            <div class="question">
                <p>5.) Le risque d'erreur alpha :</p>
                <ul>
        
                    <li><input type="checkbox" id="q5a" name="q5" value="A"> A- est le risque d'erreur de 2ème espèce</li>
            
                    <li><input type="checkbox" id="q5b" name="q5" value="B"> B- est correspond à un défaut de puissance</li>
            
                    <li><input type="checkbox" id="q5c" name="q5" value="C"> C- est d'environ 5%</li>
            
                    <li><input type="checkbox" id="q5d" name="q5" value="D"> D- signifie que le test ne peut pas conclure à une différence statistiquement significative</li>
            
                    <li><input type="checkbox" id="q5e" name="q5" value="E"> E- c'est l'erreur de conclure à une différence significative alors que c'est faux</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q5')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q5')">Réessayer</button>
                <button class="favorite-button" data-question="5">&#10084;</button>
            </div>
        </div>
        
        <div id="question-6" class="question-container">
            <div class="question">
                <p>6.) On effectue une enquête sur un échantillon de 1000 personnes pour connaître la fréquence d'une maladie virale. 100 cas sont dépistés. L'intervalle de confiance à 95% de la fréquence de la maladie est :</p>
                <ul>
        
                    <li><input type="checkbox" id="q6a" name="q6" value="A"> A- 0,71-0,85</li>
            
                    <li><input type="checkbox" id="q6b" name="q6" value="B"> B- 0,7-1,085</li>
            
                    <li><input type="checkbox" id="q6c" name="q6" value="C"> C- 1,96-2,3</li>
            
                    <li><input type="checkbox" id="q6d" name="q6" value="D"> D- 8,14%-11,86%</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q6')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q6')">Réessayer</button>
                <button class="favorite-button" data-question="6">&#10084;</button>
            </div>
        </div>
        
        <div id="question-7" class="question-container">
            <div class="question">
                <p>7.) On mesure le taux de glycémie chez 22 individus diabétiques avant et 12 heures après l'injection d'une insuline. Le test à utiliser est :</p>
                <ul>
        
                    <li><input type="checkbox" id="q7a" name="q7" value="A"> A- Test de Kh2 pour séries indépendantes</li>
            
                    <li><input type="checkbox" id="q7b" name="q7" value="B"> B- Test de Student pour séries appariées</li>
            
                    <li><input type="checkbox" id="q7c" name="q7" value="C"> C- Test de Kh2 pour séries appariées</li>
            
                    <li><input type="checkbox" id="q7d" name="q7" value="D"> D- Test de corrélation</li>
            
                    <li><input type="checkbox" id="q7e" name="q7" value="E"> E- Test Z</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q7')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q7')">Réessayer</button>
                <button class="favorite-button" data-question="7">&#10084;</button>
            </div>
        </div>
        
        <div id="question-8" class="question-container">
            <div class="question">
                <p>8.) On sait que dans la population générale des femmes enceintes, la variable âge est distribuée selon une loi normale de moyenne 30 ans et de variance 16. De plus, la proportion de femmes infectées par la toxoplasmose dans cette population est de 10%. L'intervalle de confiance à 95% pour l'âge des femmes enceintes pour un échantillon de taille 1000 est :</p>
                <ul>
        
                    <li><input type="checkbox" id="q8a" name="q8" value="A"> A- 24,608 à 25,392 ans</li>
            
                    <li><input type="checkbox" id="q8b" name="q8" value="B"> B- 22,027 à 27,973%</li>
            
                    <li><input type="checkbox" id="q8c" name="q8" value="C"> C- 29,75%-30,24</li>
            
                    <li><input type="checkbox" id="q8d" name="q8" value="D"> D- 8,14%-11,86%</li>
            
                    <li><input type="checkbox" id="q8e" name="q8" value="E"> E- Aucune réponse n'est juste</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q8')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q8')">Réessayer</button>
                <button class="favorite-button" data-question="8">&#10084;</button>
            </div>
        </div>
        
        <div id="question-9" class="question-container">
            <div class="question">
                <p>9.) Une étude porte sur 270 sujets. Les résultats sont présentés dans le tableau suivant. L'objectif de l'analyse présentée était de déterminer s'il existait une association entre l'hémorragie digestive et la prise d'Anti-inflammatoire Non Stéroïdiens (AINS). Quel test statistique doit-on effectuer ?</p>
                <ul>
        
                    <li><input type="checkbox" id="q9a" name="q9" value="A"> A- Un test de Khi2 à 3 degré de liberté</li>
            
                    <li><input type="checkbox" id="q9b" name="q9" value="B"> B- Un test de Khi2 à 2 degré de liberté</li>
            
                    <li><input type="checkbox" id="q9c" name="q9" value="C"> C- Un test de Khi2 à 1 degré de liberté</li>
            
                    <li><input type="checkbox" id="q9d" name="q9" value="D"> D- Un test de Student à 3 degré de liberté</li>
            
                    <li><input type="checkbox" id="q9e" name="q9" value="E"> E- Un test de Student à 2 degré de liberté</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q9')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q9')">Réessayer</button>
                <button class="favorite-button" data-question="9">&#10084;</button>
            </div>
        </div>
        
        <div id="question-10" class="question-container">
            <div class="question">
                <p>10.) On étudie la relation entre tabagisme et cancer du poumon, et après avoir effectué un test de Khi2 dont la valeur est 4 avec 1 degré de liberté, on peut conclure que :</p>
                <ul>
        
                    <li><input type="checkbox" id="q10a" name="q10" value="A"> A- Le tabagisme est associé au cancer du poumon avec un p<0,05</li>
            
                    <li><input type="checkbox" id="q10b" name="q10" value="B"> B- Le tabagisme n'est pas significativement associé au cancer du poumon</li>
            
                    <li><input type="checkbox" id="q10c" name="q10" value="C"> C- Le tabagisme est lié au cancer du poumon avec un p>0,05</li>
            
                    <li><input type="checkbox" id="q10d" name="q10" value="D"> D- Il y a une relation inverse entre le tabagisme et le cancer</li>
            
                    <li><input type="checkbox" id="q10e" name="q10" value="E"> E- Le tabagisme et le cancer sont indépendants</li>
            
                </ul>
            </div>
            <div class="action-buttons">
                <button type="button" class="correct-button" onclick="correctQuestion('q10')">Corriger</button>
                <button type="button" class="reset-button" onclick="resetQuestion('q10')">Réessayer</button>
                <button class="favorite-button" data-question="10">&#10084;</button>
            </div>
        </div>
        
            <div class="button-container">
                <button type="button" class="submit-quiz-button" onclick="submitQuiz()">Soumettre tout le Quiz</button>
                <button id="voir-favoris-btn" class="favorite-button" onclick="voirFavoris2016R()">Voir Favoris</button>
            </div>

            <div class="blur-background" id="blur-background"></div>

            <div class="result-popup" id="result-popup">
                <h3>Résultat du Quiz</h3>
                <div id="result"></div>
                <button id="close-result" class="close-button" onclick="closeResult(event)">Fermer</button>
                <button id="voir-detail-btn" class="detail-button" style="display: none;" onclick="afficherDetails(event)">Voir Détail</button>
                <button type="button" class="reset-quiz-button" onclick="resetAll()">Réessayer tout le Quiz</button>
            </div>

            <div id="details-section" class="details-section" style="display: none;">
                <h3>Tableau des questions</h3>
                <div class="question-links" id="question-links"></div>
            </div>

            <div id="timer-container">
                <span id="timer">60:00</span>
            </div>

            <div id="details-section" style="display:none;">
                <h2>Questions :</h2>
                <div id="question-links" class="question-links"></div>
            </div>

            <script>
                // Scripts pour la gestion du quiz
            </script>
        </form>
        </div>
    </body>
    </html>
// Fonction pour corriger une question
function correctQuestion(questionName) {
    const form = document.getElementById('quiz-form');
    const questionDiv = document.querySelector(`input[name="${questionName}"]`).closest('.question-container');
    const selected = Array.from(form.elements[questionName]).filter(input => input.checked).map(input => input.value);

    // Calculer si la réponse est correcte
    const isCorrect = JSON.stringify(correctAnswers[questionName].sort()) === JSON.stringify(selected.sort());

    // Enregistre si la réponse est correcte ou incorrecte
    userAnswers[questionName] = {
        selected: selected,
        isCorrect: isCorrect
    };

    // Supprimer les styles précédents
    questionDiv.classList.remove('correct', 'incorrect');
    questionDiv.querySelectorAll('li').forEach(li => li.style.color = '');

    // Applique les couleurs selon la validité des réponses
    questionDiv.querySelectorAll('li').forEach(li => {
        const isChoiceCorrect = correctAnswers[questionName].includes(li.querySelector('input').value);
        const isSelected = selected.includes(li.querySelector('input').value);

        if (isChoiceCorrect) {
            // Appliquer le style vert aux bonnes réponses
            li.style.color = 'green';
            li.style.fontWeight = 'bold';
            li.style.textShadow = '1px 1px 2px rgba(0, 128, 0, 0.7)';
        }

        if (isSelected && !isChoiceCorrect) {
            // Appliquer le style rouge pour les mauvaises réponses sélectionnées
            li.style.color = 'red';
        }
    });

    console.log(`Début de la correction pour la question ${questionName}`);
    console.log(`Réponses sélectionnées pour ${questionName}: ${selected.join(', ')}`);
    console.log(`Résultat pour ${questionName}: ${isCorrect ? 'Correct' : 'Incorrect'}`);

    // Déterminer le nom de l'examen et l'ID complet de la question
    const examNameElement = document.getElementById('exam_name');
    const examName = examNameElement.value; // Nom de l'examen (par exemple, Anatomie2023)
    const fullChoiceIds = selected.map(choice => `${examName}_${questionName.substring(1)}_${choice.toLowerCase()}`);
    console.log(`IDs complets générés pour les choix : ${fullChoiceIds.join(', ')}`);

    // Envoyer les données au serveur
    fetch('/track_attempts/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({
            question_name: questionName,
            full_choice_ids: fullChoiceIds
        })
    })
        .then(response => response.json())
        .then(data => {
            console.log(`Données reçues du serveur : ${JSON.stringify(data)}`);
            handleAlert(data.alert, questionDiv);
            updateStatisticalAlerts(data, questionDiv);
        })
        .catch(error => console.error('Erreur lors de l’envoi des données:', error));
}

// Fonction pour gérer les alertes
function handleAlert(alertData, questionDiv) {
    const existingAlert = questionDiv.querySelector('.alert-indicator');
    if (existingAlert) {
        existingAlert.remove();
    }

    if (alertData) {
        const alertIndicator = document.createElement('div');
        alertIndicator.className = 'alert-indicator';
        alertIndicator.style.backgroundColor = alertData.color || '#f8d7da';
        alertIndicator.style.padding = '10px';
        alertIndicator.style.marginTop = '10px';
        alertIndicator.style.borderRadius = '5px';
        alertIndicator.style.fontWeight = 'bold';
        alertIndicator.style.color = '#721c24';
        alertIndicator.style.boxShadow = '0 2px 5px rgba(0, 0, 0, 0.1)';
        alertIndicator.textContent = alertData.message;

        questionDiv.appendChild(alertIndicator);
        saveAlertToLocalStorage(questionDiv.getAttribute('data-question-id'), alertData);
    } else {
        removeAlertFromLocalStorage(questionDiv.getAttribute('data-question-id'));
    }
}

// Charger les alertes persistantes
function loadAlertsFromLocalStorage() {
    const storedAlerts = JSON.parse(localStorage.getItem('alerts')) || {};
    Object.keys(storedAlerts).forEach(questionId => {
        const questionDiv = document.querySelector(`.question-container[data-question-id="${questionId}"]`);
        if (questionDiv) {
            handleAlert(storedAlerts[questionId], questionDiv);
        }
    });
}

// Sauvegarder les alertes dans localStorage
function saveAlertToLocalStorage(questionId, alertData) {
    const storedAlerts = JSON.parse(localStorage.getItem('alerts')) || {};
    storedAlerts[questionId] = alertData;
    localStorage.setItem('alerts', JSON.stringify(storedAlerts));
}

// Supprimer une alerte de localStorage
function removeAlertFromLocalStorage(questionId) {
    const storedAlerts = JSON.parse(localStorage.getItem('alerts')) || {};
    delete storedAlerts[questionId];
    localStorage.setItem('alerts', JSON.stringify(storedAlerts));
}

// Mise à jour des alertes statistiques
function updateStatisticalAlerts(data, questionDiv) {
    const existingStatisticalAlerts = questionDiv.querySelectorAll('.statistical-alert');
    existingStatisticalAlerts.forEach(alert => alert.remove());

    if (data.failure_rate > 0.6) {
        const failureRateAlert = document.createElement('div');
        failureRateAlert.className = 'statistical-alert';
        failureRateAlert.style.backgroundColor = '#add8e6';
        failureRateAlert.style.padding = '10px';
        failureRateAlert.style.marginTop = '10px';
        failureRateAlert.style.borderRadius = '5px';
        failureRateAlert.style.fontWeight = 'bold';
        failureRateAlert.style.color = '#004085';
        failureRateAlert.style.boxShadow = '0 2px 5px rgba(0, 0, 0, 0.1)';
        failureRateAlert.textContent = `🔵 Votre taux d'échec est de ${(data.failure_rate * 100).toFixed(0)}%. Revoir cette question est conseillé.`;

        questionDiv.appendChild(failureRateAlert);
    }
}

// Charger les alertes au démarrage
document.addEventListener('DOMContentLoaded', () => {
    loadAlertsFromLocalStorage();
});

</script>
